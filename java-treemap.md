---
title: javaæ•°æ®ç»“æ„-TreeMap
date: 2017-07-20 13:03:15
tags: [java,äºŒåˆ†æŸ¥æ‰¾,äºŒå‰æ ‘,äºŒå‰æŸ¥æ‰¾æ ‘,2-3æ ‘,çº¢é»‘æ ‘,æ•°æ®ç»“æ„]
categories: java
---
> treemapçš„åº•å±‚å®ç°æ˜¯çº¢é»‘æ ‘ï¼Œçº¢é»‘æ ‘æ˜¯å‡ºäº†åéš¾æ‡‚çš„ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« å…ˆè¯´è¯´ç›¸å…³çš„ç®—æ³•å…ˆï¼Œå†æ…¢æ…¢å›å½’åˆ°çº¢é»‘æ ‘ã€‚è¿˜æœ‰æ­¤æ–‡ç« æœ‰ç‚¹é•¿ã€‚ğŸ‘¿

# äºŒåˆ†æŸ¥æ‰¾
äºŒåˆ†æŸ¥æ‰¾åˆç§°æŠ˜åŠæŸ¥æ‰¾ï¼Œä¼˜ç‚¹æ˜¯æ¯”è¾ƒæ¬¡æ•°å°‘ï¼ŒæŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œå¹³å‡æ€§èƒ½å¥½ï¼Œå ç”¨ç³»ç»Ÿå†…å­˜è¾ƒå°‘ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºlgNï¼›å…¶ç¼ºç‚¹æ˜¯è¦æ±‚å¾…æŸ¥è¡¨ä¸ºæœ‰åºè¡¨ï¼Œä¸”æ’å…¥åˆ é™¤å›°éš¾ã€‚å› æ­¤ï¼ŒæŠ˜åŠæŸ¥æ‰¾æ–¹æ³•é€‚ç”¨äºä¸ç»å¸¸å˜åŠ¨è€ŒæŸ¥æ‰¾é¢‘ç¹çš„æœ‰åºåˆ—è¡¨ã€‚é¦–å…ˆï¼Œå‡è®¾è¡¨ä¸­å…ƒç´ æ˜¯æŒ‰å‡åºæ’åˆ—ï¼Œå°†è¡¨ä¸­é—´ä½ç½®è®°å½•çš„å…³é”®å­—ä¸æŸ¥æ‰¾å…³é”®å­—æ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œåˆ™æŸ¥æ‰¾æˆåŠŸï¼›å¦åˆ™åˆ©ç”¨ä¸­é—´ä½ç½®è®°å½•å°†è¡¨åˆ†æˆå‰ã€åä¸¤ä¸ªå­è¡¨ï¼Œå¦‚æœä¸­é—´ä½ç½®è®°å½•çš„å…³é”®å­—å¤§äºæŸ¥æ‰¾å…³é”®å­—ï¼Œåˆ™è¿›ä¸€æ­¥æŸ¥æ‰¾å‰ä¸€å­è¡¨ï¼Œå¦åˆ™è¿›ä¸€æ­¥æŸ¥æ‰¾åä¸€å­è¡¨ã€‚é‡å¤ä»¥ä¸Šè¿‡ç¨‹ï¼Œç›´åˆ°æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œä½¿æŸ¥æ‰¾æˆåŠŸï¼Œæˆ–ç›´åˆ°å­è¡¨ä¸å­˜åœ¨ä¸ºæ­¢ï¼Œæ­¤æ—¶æŸ¥æ‰¾ä¸æˆåŠŸã€‚
````java
public static int binarySearch(Integer[] srcArray, int des) {
    //å®šä¹‰åˆå§‹æœ€å°ã€æœ€å¤§ç´¢å¼•
    int low = 0;
    int high = srcArray.length - 1;
    //ç¡®ä¿ä¸ä¼šå‡ºç°é‡å¤æŸ¥æ‰¾ï¼Œè¶Šç•Œ
    while (low <= high) {
        //è®¡ç®—å‡ºä¸­é—´ç´¢å¼•å€¼
        int middle = (high + low)>>>1 ;//é˜²æ­¢æº¢å‡º
        if (des == srcArray[middle]) {
            return middle;
        //åˆ¤æ–­ä¸‹é™
        } else if (des < srcArray[middle]) {
            high = middle - 1;
        //åˆ¤æ–­ä¸Šé™
        } else {
            low = middle + 1;
        }
    }
    //è‹¥æ²¡æœ‰ï¼Œåˆ™è¿”å›-1
    return -1;
}
````
[![](http://idiotsky.me/images1/java-treemap.jpg)](http://idiotsky.me/images1/java-treemap.jpg)

# äºŒå‰æ ‘
åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒäºŒå‰æ ‘æ˜¯æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­æ ‘çš„æ ‘ç»“æ„ã€‚é€šå¸¸å­æ ‘è¢«ç§°ä½œâ€œå·¦å­æ ‘â€ï¼ˆleft subtreeï¼‰å’Œâ€œå³å­æ ‘â€ï¼ˆright subtreeï¼‰ã€‚äºŒå‰æ ‘å¸¸è¢«ç”¨äºå®ç°äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå¹³è¡¡æ ‘ï¼Œçº¢é»‘æ ‘å’ŒäºŒå‰å †ã€‚äºŒå‰æ ‘çš„åº¦å°±æ˜¯åˆ†æ”¯çš„æ•°ç›®ã€‚æ²¡æœ‰åˆ†å‰çš„äºŒå‰æ ‘èŠ‚ç‚¹çš„åº¦å°±æ˜¯0åº¦ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªåˆ†å‰å°±æ˜¯1åº¦ã€‚ä¸¤ä¸ªåˆ†å‰å°±æ˜¯2åº¦çš„å­æ ‘ã€‚
[![](http://idiotsky.me/images1/java-treemap-1.png)](http://idiotsky.me/images1/java-treemap-1.png)

## æ–œæ ‘
* å·¦æ–œæ ‘ï¼šæ‰€æœ‰ç»“ç‚¹éƒ½åªæœ‰å·¦å­æ ‘çš„äºŒå‰æ ‘ï¼›
* å³æ–œæ ‘ï¼šæ‰€æœ‰ç»“ç‚¹éƒ½åªæœ‰å³å­æ ‘çš„äºŒå‰æ ‘ï¼›
* å…¶å®åœ¨ä¸šåŠ¡é€»è¾‘ä¸­å¦‚æœçœŸæœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œé‚£ç›´æ¥ä½¿ç”¨`çº¿æ€§è¡¨`å°±å¯ä»¥äº†ï¼›
[![](http://idiotsky.me/images1/java-treemap-2.png)](http://idiotsky.me/images1/java-treemap-2.png)

## æ»¡äºŒå‰æ ‘
* æ‰€æœ‰åˆ†æ”¯ç»“ç‚¹çš„åº¦ä¸ºï¼’ï¼›
* æ‰€æœ‰å¶å­ç»“ç‚¹åªèƒ½åˆ†å¸ƒåœ¨æœ€ä¸‹å±‚ä¸Šï¼›
* åŒæ ·æ·±åº¦çš„äºŒå‰æ ‘ä¸­ï¼Œæ»¡äºŒå‰æ ‘çš„ç»“ç‚¹æ•°æœ€å¤šï¼Œå¶å­ç»“ç‚¹æ•°æœ€å¤šï¼›
[![](http://idiotsky.me/images1/java-treemap-3.png)](http://idiotsky.me/images1/java-treemap-3.png)

## å®Œå…¨äºŒå‰æ ‘
* äºŒå‰æ ‘ä»æ ¹ç»“ç‚¹å‡ºå‘ï¼ŒæŒ‰ç€å±‚æ¬¡ä»å·¦åˆ°å³éå†ï¼Œç¬¬iä¸ªç»“ç‚¹çš„ä½ç½®ä¸æ»¡äºŒå‰æ ‘ä¸­å¯¹åº”ç»“ç‚¹ä½ç½®å®Œå…¨ç›¸åŒï¼›
* æ‰€æœ‰å¶å­ç»“ç‚¹åªèƒ½å‡ºç°åœ¨æœ€ä¸‹ä¸¤å±‚ï¼›
* è‹¥ç»“ç‚¹åº¦ä¸º1ï¼Œåˆ™è¯¥ç»“ç‚¹åªæœ‰å·¦å­æ ‘ï¼Œä¸å­˜åœ¨åªæœ‰å³å­æ ‘çš„æƒ…å†µï¼›
* ç»“ç‚¹åˆ†é…`å…ˆå·¦åå³`ï¼›
[![](http://idiotsky.me/images1/java-treemap-4.png)](http://idiotsky.me/images1/java-treemap-4.png)

## äºŒå‰æ ‘çš„éå†
* å‰åºï¼šå…ˆè®¿é—®æ ¹ç»“ç‚¹ -> éå†å·¦å­æ ‘ -> éå†å³å­æ ‘ï¼›å…ˆè®¿é—®æ ¹ç»“ç‚¹
* ä¸­åºï¼šéå†å·¦å­æ ‘ -> è®¿é—®æ ¹ç»“ç‚¹ -> éå†å³å­æ ‘ï¼›ä¸­é—´è®¿é—®æ ¹ç»“ç‚¹
* ååºï¼šéå†å·¦å­æ ‘ -> éå†å³å­æ ‘ -> åè®¿é—®æ ¹ç»“ç‚¹ï¼›åè®¿é—®æ ¹ç»“ç‚¹
* å±‚åºï¼šè‡ªä¸Šè€Œä¸‹ï¼Œä»å·¦åˆ°å³é€å±‚è®¿é—®ç»“ç‚¹ï¼›
[![](http://idiotsky.me/images1/java-treemap-5.png)](http://idiotsky.me/images1/java-treemap-5.png)

# äºŒå‰æŸ¥æ‰¾æ ‘
äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œä¹Ÿç§°æœ‰åºäºŒå‰æ ‘ï¼ˆordered binary treeï¼‰,æ’åºäºŒå‰æ ‘ï¼ˆsorted binary treeï¼‰ï¼Œæ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š
1. è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›
2. è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›
3. ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ã€‚
4. æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ï¼ˆno duplicate nodesï¼‰ã€‚

å¦‚ä¸‹ä¸€ä¸ªäºŒå‰æ ‘
[![](http://idiotsky.me/images1/java-treemap-6.png)](http://idiotsky.me/images1/java-treemap-6.png)

åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒåŠ ä¸ŠèŠ‚ç‚¹ä¹‹é—´çš„å¤§å°å…³ç³»ï¼Œå°±æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ï¼š
[![](http://idiotsky.me/images1/java-treemap-7.png)](http://idiotsky.me/images1/java-treemap-7.png)

## æŸ¥æ‰¾
æŸ¥æ‰¾æ“ä½œå’ŒäºŒåˆ†æŸ¥æ‰¾ç±»ä¼¼ï¼Œå°†keyå’ŒèŠ‚ç‚¹çš„keyæ¯”è¾ƒï¼Œå¦‚æœå°äºï¼Œé‚£ä¹ˆå°±åœ¨Left NodeèŠ‚ç‚¹æŸ¥æ‰¾,å¦‚æœå¤§äºï¼Œåˆ™åœ¨Right NodeèŠ‚ç‚¹æŸ¥æ‰¾ï¼Œå¦‚æœç›¸ç­‰ï¼Œç›´æ¥è¿”å›Valueã€‚
[![](http://idiotsky.me/images1/java-treemap-8.png)](http://idiotsky.me/images1/java-treemap-8.png)

## æ’å…¥
æ’å…¥å’ŒæŸ¥æ‰¾ç±»ä¼¼ï¼Œé¦–å…ˆæŸ¥æ‰¾æœ‰æ²¡æœ‰å’Œkeyç›¸åŒçš„ï¼Œå¦‚æœæœ‰ï¼Œæ›´æ–°ï¼›å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆåˆ›å»ºæ–°çš„èŠ‚ç‚¹ã€‚
[![](http://idiotsky.me/images1/java-treemap-9.png)](http://idiotsky.me/images1/java-treemap-9.png)

ä¸‹é¢æ˜¯æ’å…¥åŠ¨ç”»æ•ˆæœï¼š
[![](http://idiotsky.me/images1/java-treemap-10.gif)](http://idiotsky.me/images1/java-treemap-10.gif)

éšæœºæ’å…¥å½¢æˆæ ‘çš„åŠ¨ç”»å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ’å…¥çš„æ—¶å€™æ ‘è¿˜æ˜¯èƒ½å¤Ÿä¿æŒè¿‘ä¼¼å¹³è¡¡çŠ¶æ€ï¼š
[![](http://idiotsky.me/images1/java-treemap-11.gif)](http://idiotsky.me/images1/java-treemap-11.gif)

## æœ€å¤§æœ€å°å€¼
å¦‚ä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘çš„æœ€å¤§æœ€å°å€¼æ˜¯æœ‰è§„å¾‹çš„ï¼š
[![](http://idiotsky.me/images1/java-treemap-12.png)](http://idiotsky.me/images1/java-treemap-12.png)

ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œæœ€å·¦å’Œæœ€å³èŠ‚ç‚¹å³ä¸ºæœ€å°å€¼å’Œæœ€å¤§å€¼

## åˆ é™¤
åˆ é™¤å…ƒç´ æ“ä½œåœ¨äºŒå‰æ ‘çš„æ“ä½œä¸­åº”è¯¥æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚é¦–å…ˆæ¥çœ‹ä¸‹æ¯”è¾ƒç®€å•çš„åˆ é™¤æœ€å¤§æœ€å°å€¼å¾—æ–¹æ³•ã€‚

ä»¥åˆ é™¤æœ€å°å€¼ä¸ºä¾‹ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°æœ€å°å€¼ï¼ŒåŠæœ€å·¦è¾¹å·¦å­æ ‘ä¸ºç©ºçš„èŠ‚ç‚¹ï¼Œç„¶åè¿”å›å…¶å³å­æ ‘ä½œä¸ºæ–°çš„å·¦å­æ ‘ã€‚æ“ä½œç¤ºæ„å›¾å¦‚ä¸‹ï¼š
[![](http://idiotsky.me/images1/java-treemap-13.png)](http://idiotsky.me/images1/java-treemap-13.png)

åˆ é™¤æœ€å¤§å€¼ä¹Ÿæ˜¯ç±»ä¼¼ã€‚

ç°åœ¨æ¥åˆ†æä¸€èˆ¬æƒ…å†µï¼Œå‡å®šæˆ‘ä»¬è¦åˆ é™¤æŒ‡å®škeyçš„æŸä¸€ä¸ªèŠ‚ç‚¹ã€‚è¿™ä¸ªé—®é¢˜çš„éš¾ç‚¹åœ¨äºï¼šåˆ é™¤æœ€å¤§æœ€å°å€¼çš„æ“ä½œï¼Œåˆ é™¤çš„èŠ‚ç‚¹åªæœ‰1ä¸ªå­èŠ‚ç‚¹æˆ–è€…æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œè¿™æ ·æ¯”è¾ƒç®€å•ã€‚ä½†æ˜¯å¦‚æœåˆ é™¤ä»»æ„èŠ‚ç‚¹ï¼Œå°±æœ‰å¯èƒ½å‡ºç°åˆ é™¤çš„èŠ‚ç‚¹æœ‰0ä¸ªï¼Œ1 ä¸ªï¼Œ2ä¸ªå­èŠ‚ç‚¹çš„æƒ…å†µï¼Œç°åœ¨æ¥é€ä¸€åˆ†æã€‚

å½“åˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹æ—¶ï¼Œç›´æ¥å°†è¯¥çˆ¶èŠ‚ç‚¹æŒ‡å‘è¯¥èŠ‚ç‚¹çš„linkè®¾ç½®ä¸ºnullã€‚
[![](http://idiotsky.me/images1/java-treemap-14.png)](http://idiotsky.me/images1/java-treemap-14.png)

å½“åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰1ä¸ªå­èŠ‚ç‚¹æ—¶ï¼Œå°†è¯¥å­èŠ‚ç‚¹æ›¿æ¢ä¸ºè¦åˆ é™¤çš„èŠ‚ç‚¹å³å¯ã€‚
[![](http://idiotsky.me/images1/java-treemap-15.png)](http://idiotsky.me/images1/java-treemap-15.png)

å½“åˆ é™¤çš„èŠ‚ç‚¹æœ‰2ä¸ªå­èŠ‚ç‚¹æ—¶ï¼Œé—®é¢˜å°±å˜å¤æ‚äº†ã€‚

å‡è®¾æˆ‘ä»¬åˆ é™¤çš„èŠ‚ç‚¹tå…·æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚å› ä¸ºtå…·æœ‰å³å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°å…¶å³å­èŠ‚ç‚¹ä¸­çš„æœ€å°èŠ‚ç‚¹ï¼Œæ›¿æ¢tèŠ‚ç‚¹çš„ä½ç½®ã€‚è¿™é‡Œæœ‰å››ä¸ªæ­¥éª¤ï¼š
1. ä¿å­˜å¸¦åˆ é™¤çš„èŠ‚ç‚¹åˆ°ä¸´æ—¶å˜é‡t
2. å°†tçš„å³èŠ‚ç‚¹çš„æœ€å°èŠ‚ç‚¹min(t.right)ä¿å­˜åˆ°ä¸´æ—¶èŠ‚ç‚¹x
3. å°†xçš„å³èŠ‚ç‚¹è®¾ç½®ä¸ºdeleteMin(t.right)ï¼Œè¯¥å³èŠ‚ç‚¹æ˜¯åˆ é™¤åï¼Œæ‰€æœ‰æ¯”x.keyæœ€å¤§çš„èŠ‚ç‚¹ã€‚
4. å°†xçš„åšèŠ‚ç‚¹è®¾ç½®ä¸ºtçš„å·¦èŠ‚ç‚¹ã€‚

æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š
[![](http://idiotsky.me/images1/java-treemap-16.png)](http://idiotsky.me/images1/java-treemap-16.png)

éšç€åˆ é™¤çš„è¿›è¡Œï¼ŒäºŒå‰æ ‘ä¼šå˜å¾—ä¸å¤ªå¹³è¡¡ï¼Œä¸‹é¢æ˜¯åŠ¨ç”»æ¼”ç¤ºã€‚
[![](http://idiotsky.me/images1/java-treemap-17.gif)](http://idiotsky.me/images1/java-treemap-17.gif)

## åˆ†æ
äºŒå‰æŸ¥æ‰¾æ ‘çš„è¿è¡Œæ—¶é—´å’Œæ ‘çš„å½¢çŠ¶æœ‰å…³ï¼Œæ ‘çš„å½¢çŠ¶åˆå’Œæ’å…¥å…ƒç´ çš„é¡ºåºæœ‰å…³ã€‚åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹å®Œå…¨å¹³è¡¡ï¼Œä»æ ¹èŠ‚ç‚¹åˆ°æœ€åº•å±‚å¶å­èŠ‚ç‚¹åªæœ‰lgNä¸ªèŠ‚ç‚¹ã€‚åœ¨æœ€å·®çš„æƒ…å†µä¸‹ï¼Œæ ¹èŠ‚ç‚¹åˆ°æœ€åº•å±‚å¶å­èŠ‚ç‚¹ä¼šæœ‰Nå„èŠ‚ç‚¹ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ ‘çš„å½¢çŠ¶å’Œæœ€å¥½çš„æƒ…å†µæ¥è¿‘ã€‚
[![](http://idiotsky.me/images1/java-treemap-18.png)](http://idiotsky.me/images1/java-treemap-18.png)

## å°ç»“
å®ƒå’ŒäºŒåˆ†æŸ¥æ‰¾ä¸€æ ·ï¼Œæ’å…¥å’ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºlgNï¼Œä½†æ˜¯åœ¨æœ€åçš„æƒ…å†µä¸‹ä»ç„¶ä¼šæœ‰Nçš„æ—¶é—´å¤æ‚åº¦ã€‚åŸå› åœ¨äºæ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œæ ‘æ²¡æœ‰ä¿æŒå¹³è¡¡ã€‚æ‰€ä»¥æˆ‘ä»¬å¸Œæœ›åœ¨æœ€åçš„æƒ…å†µä¹Ÿæœ‰è¾ƒå¥½çš„æ—¶é—´å¤æ‚åº¦ï¼Œé‚£å°±è¦æ±‚æ ‘èƒ½å¤Ÿå°½å¯èƒ½å¹³è¡¡ï¼Œä¹Ÿå°±äº§ç”Ÿäº†2-3æ ‘å’Œçº¢é»‘æ ‘ç­‰å¹³è¡¡æ ‘ã€‚


# 2-3æ ‘
2-3æ ‘å°±æ˜¯ä¸€ç§ä»¥å¹³è¡¡ä¸ºç›®çš„è€Œè¯ç”Ÿçš„æ•°æ®ç»“æ„ï¼Œä¸ºäº†ä¿è¯åœ¨æ–°èŠ‚ç‚¹æ’å…¥åä¹Ÿèƒ½ä¿è¯å¾ˆå¥½çš„å¹³è¡¡ã€‚

## å®šä¹‰
å’ŒäºŒå‰æŸ¥æ‰¾æ ‘ä¸ä¸€æ ·ï¼Œ2-3æ ‘è¿è¡Œæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜1ä¸ªæˆ–è€…ä¸¤ä¸ªçš„keyã€‚å¯¹äºæ™®é€šçš„2èŠ‚ç‚¹(2-node)ï¼Œä»–ä¿å­˜1ä¸ªkeyå’Œå·¦å³ä¸¤ä¸ªè‡ªå·±ç‚¹ã€‚å¯¹åº”3èŠ‚ç‚¹(3-node)ï¼Œä¿å­˜ä¸¤ä¸ªKeyï¼Œ2-3æŸ¥æ‰¾æ ‘çš„å®šä¹‰å¦‚ä¸‹ï¼š

1. è¦ä¹ˆä¸ºç©ºï¼Œè¦ä¹ˆå°±æ˜¯ç”±å¾ˆå¤š2-3èŠ‚ç‚¹ç»„æˆï¼š

2. å¯¹äº2èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¿å­˜ä¸€ä¸ªkeyåŠå¯¹åº”valueï¼Œä»¥åŠä¸¤ä¸ªæŒ‡å‘å·¦å³èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œå·¦èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ª2-3èŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„å€¼éƒ½æ¯”keyå°ï¼Œå³èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ª2-3èŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„å€¼æ¯”keyè¦å¤§ã€‚

3. å¯¹äº3èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¿å­˜ä¸¤ä¸ªkeyåŠå¯¹åº”valueï¼Œä»¥åŠä¸‰ä¸ªæŒ‡å‘å·¦ä¸­å³çš„èŠ‚ç‚¹ã€‚å·¦èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ª2-3èŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„å€¼å‡æ¯”ä¸¤ä¸ªkeyä¸­çš„æœ€å°çš„keyè¿˜è¦å°ï¼›ä¸­é—´èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ª2-3èŠ‚ç‚¹ï¼Œä¸­é—´èŠ‚ç‚¹çš„keyå€¼åœ¨ä¸¤ä¸ªè·ŸèŠ‚ç‚¹keyå€¼ä¹‹é—´ï¼›å³èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€ä¸ª2-3èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„æ‰€æœ‰keyå€¼æ¯”ä¸¤ä¸ªkeyä¸­çš„æœ€å¤§çš„keyè¿˜è¦å¤§ã€‚

å¦‚æœä¸­åºéå†2-3æŸ¥æ‰¾æ ‘ï¼Œå°±å¯ä»¥å¾—åˆ°æ’å¥½åºçš„åºåˆ—ã€‚åœ¨ä¸€ä¸ªå®Œå…¨å¹³è¡¡çš„2-3æŸ¥æ‰¾æ ‘ä¸­ï¼Œæ ¹èŠ‚ç‚¹åˆ°æ¯ä¸€ä¸ªä¸ºç©ºèŠ‚ç‚¹çš„è·ç¦»éƒ½ç›¸åŒã€‚
[![](http://idiotsky.me/images2/java-treemap-19.png)](http://idiotsky.me/images2/java-treemap-19.png)

## æŸ¥æ‰¾
åœ¨è¿›è¡Œ2-3æ ‘çš„å¹³è¡¡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå‡è®¾å·²ç»å¤„äºå¹³è¡¡çŠ¶æ€ï¼Œæˆ‘ä»¬å…ˆçœ‹åŸºæœ¬çš„æŸ¥æ‰¾æ“ä½œã€‚

2-3æ ‘çš„æŸ¥æ‰¾å’ŒäºŒå‰æŸ¥æ‰¾æ ‘ç±»ä¼¼ï¼Œæˆ‘ä»¬é¦–å…ˆå’Œå…¶è·ŸèŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™æŸ¥æ‰¾æˆåŠŸï¼›å¦åˆ™æ ¹æ®æ¯”è¾ƒçš„æ¡ä»¶ï¼Œåœ¨å…¶å·¦ä¸­å³å­æ ‘ä¸­é€’å½’æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°çš„èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™æœªæ‰¾åˆ°ï¼Œå¦åˆ™è¿”å›ã€‚æŸ¥æ‰¾è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š
[![](http://idiotsky.me/images2/java-treemap-20.png)](http://idiotsky.me/images2/java-treemap-20.png)

## æ’å…¥
### å¾€ä¸€ä¸ª2-nodeèŠ‚ç‚¹æ’å…¥
å¾€2-3æ ‘ä¸­æ’å…¥å…ƒç´ å’Œå¾€äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æ’å…¥å…ƒç´ ä¸€æ ·ï¼Œé¦–å…ˆè¦è¿›è¡ŒæŸ¥æ‰¾ï¼Œç„¶åå°†èŠ‚ç‚¹æŒ‚åˆ°æœªæ‰¾åˆ°çš„èŠ‚ç‚¹ä¸Šã€‚2-3æ ‘ä¹‹æ‰€ä»¥èƒ½å¤Ÿä¿è¯åœ¨æœ€å·®çš„æƒ…å†µä¸‹çš„æ•ˆç‡çš„åŸå› åœ¨äºå…¶æ’å…¥ä¹‹åä»ç„¶èƒ½å¤Ÿä¿æŒå¹³è¡¡çŠ¶æ€ã€‚å¦‚æœæŸ¥æ‰¾åæœªæ‰¾åˆ°çš„èŠ‚ç‚¹æ˜¯ä¸€ä¸ª2-nodeèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ–°çš„å…ƒç´ æ”¾åˆ°è¿™ä¸ª2-nodeèŠ‚ç‚¹é‡Œé¢ä½¿å…¶å˜æˆä¸€ä¸ª3-nodeèŠ‚ç‚¹å³å¯ã€‚ä½†æ˜¯å¦‚æœæŸ¥æ‰¾çš„èŠ‚ç‚¹ç»“æŸäºä¸€ä¸ª3-nodeèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯èƒ½æœ‰ç‚¹éº»çƒ¦ã€‚
[![](http://idiotsky.me/images2/java-treemap-21.png)](http://idiotsky.me/images2/java-treemap-21.png)

### å¾€ä¸€ä¸ª3-nodeèŠ‚ç‚¹æ’å…¥
å¾€ä¸€ä¸ª3-nodeèŠ‚ç‚¹æ’å…¥ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å¯èƒ½ä¼šé‡åˆ°å¾ˆå¤šç§ä¸åŒçš„æƒ…å†µï¼Œä¸‹é¢é¦–å…ˆä»ä¸€ä¸ªæœ€ç®€å•çš„åªåŒ…å«ä¸€ä¸ª3-nodeèŠ‚ç‚¹çš„æ ‘å¼€å§‹è®¨è®ºã€‚
#### åªåŒ…å«ä¸€ä¸ª3-nodeèŠ‚ç‚¹
[![](http://idiotsky.me/images2/java-treemap-22.png)](http://idiotsky.me/images2/java-treemap-22.png)

å¦‚ä¸Šå›¾ï¼Œå‡è®¾2-3æ ‘åªåŒ…å«ä¸€ä¸ª3-nodeèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹æœ‰ä¸¤ä¸ªkeyï¼Œæ²¡æœ‰ç©ºé—´æ¥æ’å…¥ç¬¬ä¸‰ä¸ªkeyäº†ï¼Œæœ€è‡ªç„¶çš„æ–¹å¼æ˜¯æˆ‘ä»¬å‡è®¾è¿™ä¸ªèŠ‚ç‚¹èƒ½å­˜æ”¾ä¸‰ä¸ªå…ƒç´ ï¼Œæš‚æ—¶ä½¿å…¶å˜æˆä¸€ä¸ª4-nodeèŠ‚ç‚¹ï¼ŒåŒæ—¶ä»–åŒ…å«å››ä¸ªå­èŠ‚ç‚¹ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¿™ä¸ª4-nodeèŠ‚ç‚¹çš„ä¸­é—´å…ƒç´ æå‡ï¼Œå·¦è¾¹çš„èŠ‚ç‚¹ä½œä¸ºå…¶å·¦èŠ‚ç‚¹ï¼Œå³è¾¹çš„å…ƒç´ ä½œä¸ºå…¶å³èŠ‚ç‚¹ã€‚æ’å…¥å®Œæˆï¼Œå˜ä¸ºå¹³è¡¡2-3æŸ¥æ‰¾æ ‘ï¼Œæ ‘çš„é«˜åº¦ä»0å˜ä¸º1ã€‚

#### èŠ‚ç‚¹æ˜¯3-nodeï¼Œçˆ¶èŠ‚ç‚¹æ˜¯2-node
å’Œç¬¬ä¸€ç§æƒ…å†µä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ–°çš„å…ƒç´ æ’å…¥åˆ°3-nodeèŠ‚ç‚¹ä¸­ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªä¸´æ—¶çš„4-nodeèŠ‚ç‚¹ï¼Œç„¶åï¼Œå°†è¯¥èŠ‚ç‚¹ä¸­çš„ä¸­é—´å…ƒç´ æå‡åˆ°çˆ¶èŠ‚ç‚¹å³2-nodeèŠ‚ç‚¹ä¸­ï¼Œä½¿å…¶çˆ¶èŠ‚ç‚¹æˆä¸ºä¸€ä¸ª3-nodeèŠ‚ç‚¹ï¼Œç„¶åå°†å·¦å³èŠ‚ç‚¹åˆ†åˆ«æŒ‚åœ¨è¿™ä¸ª3-nodeèŠ‚ç‚¹çš„æ°å½“ä½ç½®ã€‚æ“ä½œå¦‚ä¸‹å›¾ï¼š
[![](http://idiotsky.me/images2/java-treemap-23.png)](http://idiotsky.me/images2/java-treemap-23.png)

#### èŠ‚ç‚¹æ˜¯3-nodeï¼Œçˆ¶èŠ‚ç‚¹ä¹Ÿæ˜¯3-node
å½“æˆ‘ä»¬æ’å…¥çš„èŠ‚ç‚¹æ˜¯3-nodeçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†è¯¥èŠ‚ç‚¹æ‹†åˆ†ï¼Œä¸­é—´å…ƒç´ æå‡è‡³çˆ¶èŠ‚ç‚¹ï¼Œä½†æ˜¯æ­¤æ—¶çˆ¶èŠ‚ç‚¹æ˜¯ä¸€ä¸ª3-nodeèŠ‚ç‚¹ï¼Œæ’å…¥ä¹‹åï¼Œçˆ¶èŠ‚ç‚¹å˜æˆäº†4-nodeèŠ‚ç‚¹ï¼Œç„¶åç»§ç»­å°†ä¸­é—´å…ƒç´ æå‡è‡³å…¶çˆ¶èŠ‚ç‚¹ï¼Œç›´è‡³é‡åˆ°ä¸€ä¸ªçˆ¶èŠ‚ç‚¹æ˜¯2-nodeèŠ‚ç‚¹ï¼Œç„¶åå°†å…¶å˜ä¸º3-nodeï¼Œä¸éœ€è¦ç»§ç»­è¿›è¡Œæ‹†åˆ†ã€‚
[![](http://idiotsky.me/images2/java-treemap-24.png)](http://idiotsky.me/images2/java-treemap-24.png)

#### æ ¹èŠ‚ç‚¹åˆ†è£‚
å½“æ ¹èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹éƒ½æ˜¯3-nodeèŠ‚ç‚¹çš„æ—¶å€™ï¼Œè¿™æ—¶å¦‚æœæˆ‘ä»¬è¦åœ¨å­èŠ‚ç‚¹æ’å…¥æ–°çš„å…ƒç´ çš„æ—¶å€™ï¼Œä¼šä¸€ç›´æ‹†åˆ†åˆ°æ ¹èŠ‚ç‚¹ï¼Œåœ¨æœ€åä¸€æ­¥çš„æ—¶å€™ï¼Œæ ¹èŠ‚ç‚¹å˜æˆäº†ä¸€ä¸ª4-nodeèŠ‚ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦å°†æ ¹èŠ‚ç‚¹æ‹†åˆ†ä¸ºä¸¤ä¸ª2-nodeèŠ‚ç‚¹ï¼Œæ ‘çš„é«˜åº¦åŠ 1ï¼Œè¿™ä¸ªæ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š
[![](http://idiotsky.me/images2/java-treemap-25.png)](http://idiotsky.me/images2/java-treemap-25.png)

#### æœ¬åœ°è½¬æ¢
å°†ä¸€ä¸ª4-nodeæ‹†åˆ†ä¸º2-3nodeæ¶‰åŠåˆ°6ç§å¯èƒ½çš„æ“ä½œã€‚è¿™4-nodeå¯èƒ½åœ¨è·ŸèŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½æ˜¯2-nodeçš„å·¦å­èŠ‚ç‚¹æˆ–è€…å³å­èŠ‚ç‚¹ã€‚æˆ–è€…æ˜¯ä¸€ä¸ª3-nodeçš„å·¦ï¼Œä¸­ï¼Œå³å­èŠ‚ç‚¹ã€‚æ‰€æœ‰çš„è¿™äº›æ”¹å˜éƒ½æ˜¯æœ¬åœ°çš„ï¼Œä¸éœ€è¦æ£€æŸ¥æˆ–è€…ä¿®æ”¹å…¶ä»–éƒ¨åˆ†çš„èŠ‚ç‚¹ã€‚æ‰€ä»¥åªéœ€è¦å¸¸æ•°æ¬¡æ“ä½œå³å¯å®Œæˆ2-3æ ‘çš„å¹³è¡¡ã€‚
[![](http://idiotsky.me/images2/java-treemap-26.png)](http://idiotsky.me/images2/java-treemap-26.png)

#### æ€§è´¨
è¿™äº›æœ¬åœ°æ“ä½œä¿æŒäº†2-3æ ‘çš„å¹³è¡¡ã€‚å¯¹äº4-nodeèŠ‚ç‚¹å˜å½¢ä¸º2-3èŠ‚ç‚¹ï¼Œå˜å½¢å‰åæ ‘çš„é«˜åº¦æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚åªæœ‰å½“è·ŸèŠ‚ç‚¹æ˜¯4-nodeèŠ‚ç‚¹ï¼Œå˜å½¢åæ ‘çš„é«˜åº¦æ‰åŠ ä¸€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
[![](http://idiotsky.me/images2/java-treemap-27.png)](http://idiotsky.me/images2/java-treemap-27.png)

## åˆ†æ
[![](http://idiotsky.me/images2/java-treemap-28.png)](http://idiotsky.me/images2/java-treemap-28.png)

2-3æ ‘çš„æŸ¥æ‰¾æ•ˆç‡ä¸æ ‘çš„é«˜åº¦æ˜¯æ¯æ¯ç›¸å…³çš„ã€‚
* åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯2-nodeèŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾æ•ˆç‡ä¸ºlgN
* åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯3-nodeèŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾æ•ˆç‡ä¸ºlog3Nçº¦ç­‰äº0.631lgN

è·ç¦»æ¥è¯´ï¼Œå¯¹äº1ç™¾ä¸‡ä¸ªèŠ‚ç‚¹çš„2-3æ ‘ï¼Œæ ‘çš„é«˜åº¦ä¸º12-20ä¹‹é—´ï¼Œå¯¹äº10äº¿ä¸ªèŠ‚ç‚¹çš„2-3æ ‘ï¼Œæ ‘çš„é«˜åº¦ä¸º18-30ä¹‹é—´ã€‚

å¯¹äºæ’å…¥æ¥è¯´ï¼Œåªéœ€è¦å¸¸æ•°æ¬¡æ“ä½œå³å¯å®Œæˆï¼Œå› ä¸ºä»–åªéœ€è¦ä¿®æ”¹ä¸è¯¥èŠ‚ç‚¹å…³è”çš„èŠ‚ç‚¹å³å¯ï¼Œä¸éœ€è¦æ£€æŸ¥å…¶ä»–èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ•ˆç‡å’ŒæŸ¥æ‰¾ç±»ä¼¼ã€‚

## å®ç°
ç›´æ¥å®ç°2-3æ ‘æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºï¼š

1. éœ€è¦å¤„ç†ä¸åŒçš„èŠ‚ç‚¹ç±»å‹ï¼Œéå¸¸ç¹ç
2. éœ€è¦å¤šæ¬¡æ¯”è¾ƒæ“ä½œæ¥å°†èŠ‚ç‚¹ä¸‹ç§»
3. éœ€è¦ä¸Šç§»æ¥æ‹†åˆ†4-nodeèŠ‚ç‚¹
4. æ‹†åˆ†4-nodeèŠ‚ç‚¹çš„æƒ…å†µæœ‰å¾ˆå¤šç§

## å°ç»“
2-3æŸ¥æ‰¾æ ‘å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œåœ¨æŸäº›æƒ…å†µæ’å…¥åçš„å¹³è¡¡æ“ä½œå¯èƒ½ä¼šä½¿å¾—æ•ˆç‡é™ä½ã€‚åœ¨2-3æŸ¥æ‰¾æ ‘åŸºç¡€ä¸Šæ”¹è¿›çš„çº¢é»‘æ ‘ä¸ä»…å…·æœ‰è¾ƒé«˜çš„æ•ˆç‡ï¼Œå¹¶ä¸”å®ç°èµ·æ¥è¾ƒ2-3æŸ¥æ‰¾æ ‘ç®€å•ã€‚

ä½†æ˜¯2-3æŸ¥æ‰¾æ ‘ä½œä¸ºä¸€ç§æ¯”è¾ƒé‡è¦çš„æ¦‚å¿µå’Œæ€è·¯å¯¹äºåæ–‡è¦è®²åˆ°çš„çº¢é»‘æ ‘éå¸¸é‡è¦ã€‚

# çº¢é»‘æ ‘
ä¸Šä¸€èŠ‚å¯ä»¥çœ‹åˆ°ï¼Œ2-3æŸ¥æ‰¾æ ‘èƒ½ä¿è¯åœ¨æ’å…¥å…ƒç´ ä¹‹åèƒ½ä¿æŒæ ‘çš„å¹³è¡¡çŠ¶æ€ï¼Œæœ€åæƒ…å†µä¸‹å³æ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½æ˜¯2-nodeï¼Œæ ‘çš„é«˜åº¦ä¸ºlgNï¼Œä»è€Œä¿è¯äº†æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ã€‚ä½†æ˜¯2-3æ ‘å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œæœ¬èŠ‚ä»‹ç»ä¸€ç§ç®€å•å®ç°2-3æ ‘çš„æ•°æ®ç»“æ„ï¼Œå³çº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰

## å®šä¹‰
çº¢é»‘æ ‘çš„ä¸»è¦æ˜¯æƒ³å¯¹2-3æŸ¥æ‰¾æ ‘è¿›è¡Œç¼–ç ï¼Œå°¤å…¶æ˜¯å¯¹2-3æŸ¥æ‰¾æ ‘ä¸­çš„3-nodesèŠ‚ç‚¹æ·»åŠ é¢å¤–çš„ä¿¡æ¯ã€‚çº¢é»‘æ ‘ä¸­å°†èŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥åˆ†ä¸ºä¸¤ç§ä¸åŒç±»å‹ï¼Œçº¢è‰²é“¾æ¥ï¼Œä»–ç”¨æ¥é“¾æ¥ä¸¤ä¸ª2-nodesèŠ‚ç‚¹æ¥è¡¨ç¤ºä¸€ä¸ª3-nodesèŠ‚ç‚¹ã€‚é»‘è‰²é“¾æ¥ç”¨æ¥é“¾æ¥æ™®é€šçš„2-3èŠ‚ç‚¹ã€‚ç‰¹åˆ«çš„ï¼Œä½¿ç”¨çº¢è‰²é“¾æ¥çš„ä¸¤ä¸ª2-nodesæ¥è¡¨ç¤ºä¸€ä¸ª3-nodesèŠ‚ç‚¹ï¼Œå¹¶ä¸”å‘å·¦å€¾æ–œï¼Œå³ä¸€ä¸ª2-nodeæ˜¯å¦ä¸€ä¸ª2-nodeçš„å·¦å­èŠ‚ç‚¹ã€‚è¿™ç§åšæ³•çš„å¥½å¤„æ˜¯æŸ¥æ‰¾çš„æ—¶å€™ä¸ç”¨åšä»»ä½•ä¿®æ”¹ï¼Œå’Œæ™®é€šçš„äºŒå‰æŸ¥æ‰¾æ ‘ç›¸åŒã€‚
[![](http://idiotsky.me/images2/java-treemap-29.png)](http://idiotsky.me/images2/java-treemap-29.png)

æ ¹æ®ä»¥ä¸Šæè¿°ï¼Œçº¢é»‘æ ‘å®šä¹‰å¦‚ä¸‹ï¼š
çº¢é»‘æ ‘æ˜¯ä¸€ç§å…·æœ‰çº¢è‰²å’Œé»‘è‰²é“¾æ¥çš„å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼ŒåŒæ—¶æ»¡è¶³ï¼š
* çº¢è‰²èŠ‚ç‚¹å‘å·¦å€¾æ–œ
* ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯èƒ½æœ‰ä¸¤ä¸ªçº¢è‰²é“¾æ¥
* æ•´ä¸ªæ ‘å®Œå…¨é»‘è‰²å¹³è¡¡ï¼Œå³ä»æ ¹èŠ‚ç‚¹åˆ°æ‰€ä»¥å¶å­ç»“ç‚¹çš„è·¯å¾„ä¸Šï¼Œé»‘è‰²é“¾æ¥çš„ä¸ªæ•°éƒ½ç›¸åŒã€‚

ä¸‹å›¾å¯ä»¥çœ‹åˆ°çº¢é»‘æ ‘å…¶å®æ˜¯2-3æ ‘çš„å¦å¤–ä¸€ç§è¡¨ç°å½¢å¼ï¼šå¦‚æœæˆ‘ä»¬å°†çº¢è‰²çš„è¿çº¿æ°´å¹³ç»˜åˆ¶ï¼Œé‚£ä¹ˆä»–é“¾æ¥çš„ä¸¤ä¸ª2-nodeèŠ‚ç‚¹å°±æ˜¯2-3æ ‘ä¸­çš„ä¸€ä¸ª3-nodeèŠ‚ç‚¹äº†ã€‚
[![](http://idiotsky.me/images2/java-treemap-30.png)](http://idiotsky.me/images2/java-treemap-30.png)

## è¡¨ç¤º
æˆ‘ä»¬å¯ä»¥åœ¨äºŒå‰æŸ¥æ‰¾æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¢åŠ ä¸€ä¸ªæ–°çš„è¡¨ç¤ºé¢œè‰²çš„æ ‡è®°ã€‚è¯¥æ ‡è®°æŒ‡ç¤ºè¯¥èŠ‚ç‚¹æŒ‡å‘å…¶çˆ¶èŠ‚ç‚¹çš„é¢œè‰²ã€‚
[![](http://idiotsky.me/images2/java-treemap-31.png)](http://idiotsky.me/images2/java-treemap-31.png)

## å®ç°
### æŸ¥æ‰¾
çº¢é»‘æ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œä»–çš„æŸ¥æ‰¾æ–¹æ³•ä¹Ÿå’ŒäºŒå‰æŸ¥æ‰¾æ ‘ä¸€æ ·ï¼Œä¸éœ€è¦åšå¤ªå¤šæ›´æ”¹ã€‚

ä½†æ˜¯ç”±äºçº¢é»‘æ ‘æ¯”ä¸€èˆ¬çš„äºŒå‰æŸ¥æ‰¾æ ‘å…·æœ‰æ›´å¥½çš„å¹³è¡¡ï¼Œæ‰€ä»¥æŸ¥æ‰¾èµ·æ¥æ›´å¿«ã€‚

### å¹³è¡¡åŒ–
åœ¨ä»‹ç»æ’å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»å¦‚ä½•è®©çº¢é»‘æ ‘ä¿æŒå¹³è¡¡ï¼Œå› ä¸ºä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬æ’å…¥å®Œæˆä¹‹åï¼Œéœ€è¦å¯¹æ ‘è¿›è¡Œå¹³è¡¡åŒ–æ“ä½œä»¥ä½¿å…¶æ»¡è¶³å¹³è¡¡åŒ–ã€‚

#### æ—‹è½¬
æ—‹è½¬åˆåˆ†ä¸º__å·¦æ—‹__å’Œ__å³æ—‹__ã€‚é€šå¸¸å·¦æ—‹æ“ä½œç”¨äºå°†ä¸€ä¸ªå‘å³å€¾æ–œçš„çº¢è‰²é“¾æ¥æ—‹è½¬ä¸ºå‘å·¦é“¾æ¥ã€‚å¯¹æ¯”æ“ä½œå‰åï¼Œå¯ä»¥çœ‹å‡ºï¼Œè¯¥æ“ä½œå®é™…ä¸Šæ˜¯å°†çº¢çº¿é“¾æ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¸­çš„ä¸€ä¸ªè¾ƒå¤§çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°æ ¹èŠ‚ç‚¹ä¸Šã€‚

å·¦æ—‹çš„åŠ¨ç”»æ•ˆæœå¦‚ä¸‹ï¼š 
[![](http://idiotsky.me/images2/java-treemap-32.gif)](http://idiotsky.me/images2/java-treemap-32.gif)

å³æ—‹çš„åŠ¨ç”»æ•ˆæœå¦‚ä¸‹ï¼š
[![](http://idiotsky.me/images2/java-treemap-33.gif)](http://idiotsky.me/images2/java-treemap-33.gif)

#### é¢œè‰²åè½¬
å½“å‡ºç°ä¸€ä¸ªä¸´æ—¶çš„4-nodeçš„æ—¶å€™ï¼Œå³ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹å‡ä¸ºçº¢è‰²ï¼Œå¦‚ä¸‹å›¾ï¼š
[![](http://idiotsky.me/images2/java-treemap-34.png)](http://idiotsky.me/images2/java-treemap-34.png)

[![](http://idiotsky.me/images2/java-treemap-35.png)](http://idiotsky.me/images2/java-treemap-35.png)

è¿™å…¶å®æ˜¯ä¸ªAï¼ŒEï¼ŒS 4-nodeè¿æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†Eæå‡è‡³çˆ¶èŠ‚ç‚¹ï¼Œæ“ä½œæ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠEå¯¹å­èŠ‚ç‚¹çš„è¿çº¿è®¾ç½®ä¸ºé»‘è‰²ï¼Œè‡ªå·±çš„é¢œè‰²è®¾ç½®ä¸ºçº¢è‰²ã€‚

æœ‰äº†ä»¥ä¸ŠåŸºæœ¬æ“ä½œæ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨å¯¹åº”ä¹‹å‰å¯¹__2-3æ ‘çš„å¹³è¡¡æ“ä½œæ¥å¯¹çº¢é»‘æ ‘è¿›è¡Œå¹³è¡¡æ“ä½œ__ï¼Œè¿™ä¸¤è€…æ˜¯å¯ä»¥ä¸€ä¸€å¯¹åº”çš„ï¼Œå¦‚ä¸‹å›¾ï¼š
[![](http://idiotsky.me/images2/java-treemap-36.png)](http://idiotsky.me/images2/java-treemap-36.png)

ç°åœ¨æ¥è®¨è®ºå„ç§æƒ…å†µï¼š

#### Case 1 å¾€ä¸€ä¸ª2-nodeèŠ‚ç‚¹åº•éƒ¨æ’å…¥æ–°çš„èŠ‚ç‚¹
å…ˆçƒ­èº«ä¸€ä¸‹ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹å¯¹äºåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„çº¢é»‘æ ‘ï¼Œæ’å…¥ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹çš„æ“ä½œï¼š
[![](http://idiotsky.me/images2/java-treemap-37.png)](http://idiotsky.me/images2/java-treemap-37.png)

è¿™ç§æƒ…å†µå¾ˆç®€å•ï¼Œåªéœ€è¦ï¼š
* æ ‡å‡†çš„äºŒå‰æŸ¥æ‰¾æ ‘éå†å³å¯ã€‚__æ–°æ’å…¥çš„èŠ‚ç‚¹æ ‡è®°ä¸ºçº¢è‰²__
* å¦‚æœæ–°æ’å…¥çš„èŠ‚ç‚¹åœ¨çˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦è¿›è¡Œå·¦æ—‹æ“ä½œ

#### Case 2å¾€ä¸€ä¸ª3-nodeèŠ‚ç‚¹åº•éƒ¨æ’å…¥æ–°çš„èŠ‚ç‚¹
å…ˆçƒ­èº«ä¸€ä¸‹ï¼Œå‡è®¾æˆ‘ä»¬å¾€ä¸€ä¸ªåªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹çš„æ ‘ä¸­æ’å…¥å…ƒç´ ï¼Œå¦‚ä¸‹å›¾ï¼Œæ ¹æ®å¾…æ’å…¥å…ƒç´ ä¸å·²æœ‰å…ƒç´ çš„å¤§å°ï¼Œåˆå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š
[![](http://idiotsky.me/images2/java-treemap-38.png)](http://idiotsky.me/images2/java-treemap-38.png)

* å¦‚æœå¸¦æ’å…¥çš„èŠ‚ç‚¹æ¯”ç°æœ‰çš„ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å¤§ï¼Œè¿™ç§æƒ…å†µæœ€ç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦å°†æ–°æ’å…¥çš„èŠ‚ç‚¹è¿æ¥åˆ°å³è¾¹å­æ ‘ä¸Šå³å¯ï¼Œç„¶åå°†ä¸­é—´çš„å…ƒç´ æå‡è‡³æ ¹èŠ‚ç‚¹ã€‚è¿™æ ·æ ¹èŠ‚ç‚¹çš„å·¦å³å­æ ‘éƒ½æ˜¯çº¢è‰²çš„èŠ‚ç‚¹äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç ”FlipColoræ–¹æ³•å³å¯ã€‚å…¶ä»–æƒ…å†µç»è¿‡åè½¬æ“ä½œåéƒ½ä¼šå’Œè¿™ä¸€æ ·ã€‚
* å¦‚æœæ’å…¥çš„èŠ‚ç‚¹æ¯”æœ€å°çš„å…ƒç´ è¦å°ï¼Œé‚£ä¹ˆå°†æ–°èŠ‚ç‚¹æ·»åŠ åˆ°æœ€å·¦ä¾§ï¼Œè¿™æ ·å°±æœ‰ä¸¤ä¸ªè¿æ¥çº¢è‰²çš„èŠ‚ç‚¹äº†ï¼Œè¿™æ˜¯å¯¹ä¸­é—´èŠ‚ç‚¹è¿›è¡Œå³æ—‹æ“ä½œï¼Œä½¿ä¸­é—´ç»“ç‚¹æˆä¸ºæ ¹èŠ‚ç‚¹ã€‚è¿™æ˜¯å°±è½¬æ¢åˆ°äº†ç¬¬ä¸€ç§æƒ…å†µï¼Œè¿™æ—¶å€™åªéœ€è¦å†è¿›è¡Œä¸€æ¬¡FlipColoræ“ä½œå³å¯ã€‚
* å¦‚æœæ’å…¥çš„èŠ‚ç‚¹çš„å€¼ä½äºä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´ï¼Œé‚£ä¹ˆå°†æ–°èŠ‚ç‚¹æ’å…¥åˆ°å·¦ä¾§èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ã€‚å› ä¸ºè¯¥èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œå·¦æ—‹æ“ä½œã€‚æ“ä½œå®Œä¹‹åå°±å˜æˆç¬¬äºŒç§æƒ…å†µäº†ï¼Œå†è¿›è¡Œä¸€æ¬¡å³æ—‹ï¼Œç„¶åå†è°ƒç”¨FlipColoræ“ä½œå³å¯å®Œæˆå¹³è¡¡æ“ä½œã€‚

æœ‰äº†ä»¥ä¸ŠåŸºç¡€ï¼Œæˆ‘ä»¬ç°åœ¨æ¥æ€»ç»“ä¸€ä¸‹å¾€ä¸€ä¸ª3-nodeèŠ‚ç‚¹åº•éƒ¨æ’å…¥æ–°çš„èŠ‚ç‚¹çš„æ“ä½œæ­¥éª¤ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„æ“ä½œè¿‡ç¨‹å›¾ï¼š
[![](http://idiotsky.me/images2/java-treemap-39.png)](http://idiotsky.me/images2/java-treemap-39.png)

å¯ä»¥çœ‹å‡ºï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š
1. æ‰§è¡Œæ ‡å‡†çš„äºŒå‰æŸ¥æ‰¾æ ‘æ’å…¥æ“ä½œï¼Œ__æ–°æ’å…¥çš„èŠ‚ç‚¹å…ƒç´ ç”¨çº¢è‰²æ ‡è¯†__ã€‚
2. å¦‚æœéœ€è¦å¯¹4-nodeèŠ‚ç‚¹è¿›è¡Œæ—‹è½¬æ“ä½œ
3. å¦‚æœéœ€è¦ï¼Œè°ƒç”¨FlipColoræ–¹æ³•å°†çº¢è‰²èŠ‚ç‚¹æå‡
4. å¦‚æœéœ€è¦ï¼Œ__å·¦æ—‹æ“ä½œä½¿çº¢è‰²èŠ‚ç‚¹å·¦å€¾__ã€‚
5. åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œéœ€è¦é€’å½’è°ƒç”¨Case1 Case2ï¼Œæ¥è¿›è¡Œé€’å½’æ“ä½œã€‚å¦‚ä¸‹ï¼š

[![](http://idiotsky.me/images2/java-treemap-40.png)](http://idiotsky.me/images2/java-treemap-40.png)

### åˆ†æ
å¯¹çº¢é»‘æ ‘çš„åˆ†æå…¶å®å°±æ˜¯å¯¹2-3æŸ¥æ‰¾æ ‘çš„åˆ†æï¼Œçº¢é»‘æ ‘èƒ½å¤Ÿä¿è¯åœ¨æœ€åçš„æƒ…å†µä¸‹éƒ½èƒ½ä¿è¯å¯¹æ•°çš„æ—¶é—´å¤æ‚åº¦ï¼Œä¹Ÿå°±æ˜¯æ ‘çš„é«˜åº¦ã€‚

åœ¨åˆ†æä¹‹å‰ï¼Œä¸ºäº†æ›´åŠ ç›´è§‚ï¼Œä¸‹é¢æ˜¯ä»¥å‡åºï¼Œé™åºå’Œéšæœºæ„å»ºä¸€é¢—çº¢é»‘æ ‘çš„åŠ¨ç”»ï¼š

ä»¥å‡åºæ’å…¥æ„å»ºçº¢é»‘æ ‘ï¼š
[![](http://idiotsky.me/images2/java-treemap-41.gif)](http://idiotsky.me/images2/java-treemap-41.gif)

ä»¥é™åºæ’å…¥æ„å»ºçº¢é»‘æ ‘ï¼š
[![](http://idiotsky.me/images2/java-treemap-42.gif)](http://idiotsky.me/images2/java-treemap-42.gif)

éšæœºæ’å…¥æ„å»ºçº¢é»‘æ ‘:
[![](http://idiotsky.me/images2/java-treemap-43.gif)](http://idiotsky.me/images2/java-treemap-43.gif)

ä»ä¸Šé¢ä¸‰å¼ åŠ¨ç”»æ•ˆæœä¸­ï¼Œå¯ä»¥å¾ˆç›´è§‚çš„çœ‹å‡ºï¼Œçº¢é»‘æ ‘åœ¨å„ç§æƒ…å†µä¸‹éƒ½èƒ½ç»´æŠ¤è‰¯å¥½çš„å¹³è¡¡æ€§ï¼Œä»è€Œèƒ½å¤Ÿä¿è¯æœ€å·®æƒ…å†µä¸‹çš„æŸ¥æ‰¾ï¼Œæ’å…¥æ•ˆç‡ã€‚

ä¸‹é¢æ¥åˆ†æä¸‹çº¢é»‘æ ‘çš„æ•ˆç‡ï¼š

#### åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œçº¢é»‘æ ‘çš„é«˜åº¦ä¸è¶…è¿‡2lgN
æœ€åçš„æƒ…å†µå°±æ˜¯ï¼Œçº¢é»‘æ ‘ä¸­é™¤äº†æœ€å·¦ä¾§è·¯å¾„å…¨éƒ¨æ˜¯ç”±3-nodeèŠ‚ç‚¹ç»„æˆï¼Œå³__çº¢é»‘ç›¸é—´çš„è·¯å¾„é•¿åº¦æ˜¯å…¨é»‘è·¯å¾„é•¿åº¦çš„2å€__ã€‚

ä¸‹å›¾æ˜¯ä¸€ä¸ªå…¸å‹çš„çº¢é»‘æ ‘ï¼Œä»ä¸­å¯ä»¥çœ‹åˆ°æœ€é•¿çš„è·¯å¾„(çº¢é»‘ç›¸é—´çš„è·¯å¾„)æ˜¯æœ€çŸ­è·¯å¾„çš„2å€ï¼š
[![](http://idiotsky.me/images2/java-treemap-44.png)](http://idiotsky.me/images2/java-treemap-44.png)

#### çº¢é»‘æ ‘çš„å¹³å‡é«˜åº¦å¤§çº¦ä¸ºlgN
ç”±äºçº¢é»‘æ ‘æ˜¯2-3æŸ¥æ‰¾æ ‘çš„ä¸€ç§å®ç°ï¼Œæ‰€ä»¥å¹³å‡é«˜åº¦å¤§çº¦ä¸ºlgN

## å°ç»“
å‰é¢è®²è§£äº†è‡ªå¹³è¡¡æŸ¥æ‰¾æ ‘ä¸­çš„2-3æŸ¥æ‰¾æ ‘ï¼Œè¿™ç§æ•°æ®ç»“æ„åœ¨æ’å…¥ä¹‹åèƒ½å¤Ÿè¿›è¡Œè‡ªå¹³è¡¡æ“ä½œï¼Œä»è€Œä¿è¯äº†æ ‘çš„é«˜åº¦åœ¨ä¸€å®šçš„èŒƒå›´å†…è¿›è€Œèƒ½å¤Ÿä¿è¯æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ã€‚ä½†æ˜¯2-3æŸ¥æ‰¾æ ‘å®ç°èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œçº¢é»‘æ ‘æ˜¯2-3æ ‘çš„ä¸€ç§ç®€å•é«˜æ•ˆçš„å®ç°ï¼Œä»–å·§å¦™åœ°ä½¿ç”¨é¢œè‰²æ ‡è®°æ¥æ›¿ä»£2-3æ ‘ä¸­æ¯”è¾ƒéš¾å¤„ç†çš„3-nodeèŠ‚ç‚¹é—®é¢˜ã€‚çº¢é»‘æ ‘æ˜¯ä¸€ç§æ¯”è¾ƒé«˜æ•ˆçš„å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œåº”ç”¨éå¸¸å¹¿æ³›ï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€çš„å†…éƒ¨å®ç°éƒ½æˆ–å¤šæˆ–å°‘çš„é‡‡ç”¨äº†çº¢é»‘æ ‘ã€‚

# çº¢é»‘æ ‘åœ¨javaä¸­çš„å®ç°
è™½è¯´ä¸Šé¢çº¢é»‘æ ‘æ˜¯2-3æ ‘çš„ä¸€ç§å®ç°ï¼Œä½†æ˜¯åœ¨javaä¸­çº¢é»‘æ ‘æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œ3èŠ‚ç‚¹å¯ä»¥å‡ºç°åœ¨å³å­æ ‘ä¸Š
[![](http://idiotsky.me/images2/java-treemap-45.png)](http://idiotsky.me/images2/java-treemap-45.png)

ä¸Šé¢å›¾ç‰‡çš„68èŠ‚ç‚¹å¦‚æœæ˜¯æŒ‰å‰ä¸€ç« çš„å®ç°çš„è¯ï¼Œåœ¨æ’å…¥68çš„æ—¶å€™ï¼Œç›¸å½“äºåœ¨2èŠ‚ç‚¹çš„å³è¾¹æ’å…¥ï¼Œæ˜¯éœ€è¦å·¦æ—‹çš„ã€‚å¯ä¸Šå›¾å¾ˆæ˜æ˜¾åœ¨javaçš„çº¢é»‘æ ‘æ˜¯å…è®¸çš„ï¼Œæ‰€ä»¥ä¸åšä»»ä½•å¤„ç†ã€‚

ç”±äºè¿™æ ·çš„ä¸€ä¸ªè§„åˆ™ï¼Œæ‰“ç ´äº†ä¹‹å‰çº¢é»‘æ ‘å¯ä»¥é€šè¿‡2-3æ ‘æ¥ç†è§£çš„æ€è·¯ï¼Œæ‰€ä»¥javaå®ç°è¿™é‡Œä¼šé€šè¿‡å¦å¤–äº›è§„åˆ™æ¥ç†è§£ã€‚å½“ç„¶å‰é¢æ‰€å­¦çš„æ˜¯ä¸ä¼šç™½è´¹çš„ğŸ‘¿

## è§„åˆ™
ä»¥ä¸‹æ˜¯Javaä¸­å®ç°çš„ä¸€äº›è§„åˆ™
1. æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰é¢œè‰²ï¼ˆçº¢æˆ–é»‘ï¼‰ï¼›
2. æ ¹èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ï¼›
3. å¶å­èŠ‚ç‚¹ï¼ˆnullèŠ‚ç‚¹ï¼‰æ˜¯é»‘çš„ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼ˆå…¶ä¸­ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªå¯èƒ½æ˜¯nullèŠ‚ç‚¹ï¼‰ï¼›
4. ç›¸è¿èŠ‚ç‚¹ä¸èƒ½éƒ½æ˜¯çº¢è‰²ï¼ˆçº¢è‰²èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹å¿…é¡»ä¸ºé»‘è‰²ï¼‰ï¼›ï¼ˆè¿™æ¡åœ¨åŸºäº2-3æ ‘å®ç°çš„çº¢é»‘æ ‘ä¹Ÿæœ‰ï¼‰
5. ä»»æ„èŠ‚ç‚¹åˆ°å®ƒæ‰€æœ‰çš„å¶å­èŠ‚ç‚¹çš„è·¯å¾„éƒ½å«æœ‰ç›¸åŒçš„é»‘è‰²èŠ‚ç‚¹çš„æ•°é‡ã€‚

å…¶å®åœ¨javaçš„å®ç°è¿˜æœ‰ä¸ªè§„åˆ™è·Ÿå‰é¢ç« èŠ‚æ˜¯ä¸€è‡´çš„ï¼Œå°±æ˜¯__æ’å…¥çš„èŠ‚ç‚¹ä¸€å¼€å§‹éƒ½æ˜¯çº¢è‰²çš„__

>å¼•ç”³è§„åˆ™
>è¿˜æœ‰ä¸Šå›¾22èŠ‚ç‚¹å’Œ65èŠ‚ç‚¹ç»“åˆè§„åˆ™4å’Œ5ï¼Œä¼šå‘ç°ä¸€ä¸ªæœ‰è¶£çš„ä¸œè¥¿ï¼šå¦‚æœä¸€ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªå­èŠ‚ç‚¹è‚¯å®šæ˜¯çº¢è‰²çš„å¹¶ä¸”æ²¡æœ‰å­èŠ‚ç‚¹ã€‚

## èŠ‚ç‚¹
ä¸‹é¢æ˜¯ä»£è¡¨æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹çš„ä»£ç ã€‚
````java
static final class Entry<K,V> implements Map.Entry<K,V> {
    K key;//å…³é”®å­—
    V value;//å€¼
    Entry<K,V> left;//æŒ‡å‘å·¦èŠ‚ç‚¹
    Entry<K,V> right;//æŒ‡å‘å³èŠ‚ç‚¹
    Entry<K,V> parent;//æŒ‡å‘çˆ¶èŠ‚ç‚¹
    boolean color = BLACK; //çº¢é»‘èŠ‚ç‚¹æ ‡è®°
    //....
}
````

## æŸ¥æ‰¾
çº¢é»‘æ ‘æŸ¥æ‰¾è·Ÿæ™®é€šçš„äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾æ˜¯ä¸€æ ·çš„ã€‚
````java
final Entry<K,V> getEntry(Object key) {
        // Offload comparator-based version for sake of performance
        if (comparator != null)
            return getEntryUsingComparator(key);
        if (key == null)
            throw new NullPointerException();
        @SuppressWarnings("unchecked")
            Comparable<? super K> k = (Comparable<? super K>) key;
        //ä»æ ¹èŠ‚ç‚¹å¼€å§‹
        Entry<K,V> p = root;
        while (p != null) {
            //æ¯”è¾ƒ
            int cmp = k.compareTo(p.key);
            //å°äºçš„è¯ï¼Œç»§ç»­æœç´¢å·¦å­æ ‘
            if (cmp < 0)
                p = p.left;
            //å¤§äºçš„è¯ï¼Œç»§ç»­æœç´¢å³å­æ ‘
            else if (cmp > 0)
                p = p.right;
            //æ‰¾åˆ°å°±è¿”å›
            else
                return p;
        }
        return null;
    }
````

## æ’å…¥
çº¢é»‘æ ‘ç›¸æ¯”äºŒå‰æŸ¥æ‰¾æ ‘æ¥è¯´ï¼Œæœ€ä¸»è¦çš„ä¼˜åŠ¿åœ¨äºè‡ªå¹³è¡¡ï¼Œæ‰€ä»¥åœ¨æ’å…¥çš„æ—¶å€™é™¤äº†æ‰¾åˆ°åˆé€‚ä½ç½®æ’å…¥å¤–ï¼Œè¿˜ä¼šåšå¾ˆå¤šçš„å¹³è¡¡å¤„ç†ã€‚
åœ¨javaçš„å®ç°ä¸­ä¸»è¦æœ‰ä¸Šé¢å‡ ä¸ªè§„åˆ™çº¦æŸï¼Œæ‰€ä»¥æ’å…¥åæœ‰å¯èƒ½ä¼šç ´åè§„åˆ™ã€‚
````java
public V put(K key, V value) {
        Entry<K,V> t = root;
        if (t == null) {//å¦‚æœæ ¹èŠ‚ç‚¹æ˜¯nullï¼Œç›´æ¥æ’å…¥
            compare(key, key); // type (and possibly null) check

            root = new Entry<>(key, value, null);
            size = 1;
            modCount++;
            return null;
        }
        int cmp;
        Entry<K,V> parent;
        // split comparator and comparable paths
        Comparator<? super K> cpr = comparator;
        if (cpr != null) {//å¦‚æœå®ç°äº†comparatorå°±ç”¨comparatoræ¯”è¾ƒå¤§å°ï¼Œå¦åˆ™ç”¨é€šç”¨çš„Comparableæ¯”è¾ƒå¤§å°
            do {
                parent = t;
                cmp = cpr.compare(key, t.key);
                if (cmp < 0)
                    t = t.left;
                else if (cmp > 0)
                    t = t.right;
                else
                    return t.setValue(value);
            } while (t != null);
        }
        else {
            if (key == null)
                throw new NullPointerException();
            @SuppressWarnings("unchecked")
                Comparable<? super K> k = (Comparable<? super K>) key;
            do {
                parent = t;
                cmp = k.compareTo(t.key);
                if (cmp < 0)
                    t = t.left;
                else if (cmp > 0)
                    t = t.right;
                else
                    return t.setValue(value);
            } while (t != null);
        }
        //æ²¡æ‰¾åˆ°èŠ‚ç‚¹ï¼Œåˆ™è¿›è¡Œæ’å…¥ï¼Œå°äºå°±æ’å…¥å·¦èŠ‚ç‚¹ï¼Œå¤§äºå°±æ’å…¥å³èŠ‚ç‚¹
        Entry<K,V> e = new Entry<>(key, value, parent);
        if (cmp < 0)
            parent.left = e;
        else
            parent.right = e;
        //æ’å…¥ä¹‹åå¯èƒ½è¿åäº†çº¢é»‘æ ‘çš„è§„åˆ™ï¼Œéœ€è¦è¿›è¡Œè°ƒæ•´
        fixAfterInsertion(e);
        size++;
        modCount++;
        return null;
    }
````
å‡½æ•°`fixAfterInsertion`å¾ˆé‡è¦ï¼Œä¸‹é¢æ³¨é‡Šå…ˆç”¨2-3æ ‘çš„æ€ç»´æ¥äº†è§£çš„ã€‚
````java
private void fixAfterInsertion(Entry<K,V> x) {
        x.color = RED;//ä¸€å¼€å§‹æ’å…¥çš„èŠ‚ç‚¹æ ‡è®°ä¸ºçº¢è‰²
        //å¦‚æœxçš„çˆ¶èŠ‚ç‚¹ä¸ºçº¢è‰²è€Œä¸”xä¸ä¸ºæ ¹ç»“ç‚¹,å°±ç»§ç»­å¾ªç¯ä¸‹å»ã€‚
        //ç”±äºçˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œæ‰€ä»¥æ“ä½œåªå¤„ç†3èŠ‚ç‚¹çš„æ’å…¥å¤„ç†ã€‚
        while (x != null && x != root && x.parent.color == RED) {
            //xåœ¨3èŠ‚ç‚¹çš„å·¦è¾¹æˆ–è€…ä¸­é—´
            if (parentOf(x) == leftOf(parentOf(parentOf(x)))) {
                Entry<K,V> y = rightOf(parentOf(parentOf(x)));
                //è¿™é‡Œçš„yæ˜¯çº¢è‰²ï¼Œå°±æ„å‘³ç€äº§ç”Ÿäº†ä¸€ä¸ª4èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¦è¿›è¡Œflip colorï¼ŒæŠŠçº¢è‰²å¾€ä¸Šé¢æå‡ã€‚
                if (colorOf(y) == RED) {
                    setColor(parentOf(x), BLACK);
                    setColor(y, BLACK);
                    setColor(parentOf(parentOf(x)), RED);
                    x = parentOf(parentOf(x));
                } else {
                    //è¿™é‡Œä»£è¡¨äº†åœ¨3èŠ‚ç‚¹ä¸­é—´æ’å…¥çš„æƒ…å†µï¼Œè¦è¿›è¡Œå·¦æ—‹ã€‚
                    if (x == rightOf(parentOf(x))) {
                        x = parentOf(x);
                        rotateLeft(x);
                    }
                    //è¿™é‡Œä»£è¡¨äº†åœ¨3èŠ‚ç‚¹å·¦è¾¹æ’å…¥çš„æƒ…å†µï¼Œè¦è¿›è¡Œå³æ—‹ã€‚
                    setColor(parentOf(x), BLACK);
                    setColor(parentOf(parentOf(x)), RED);
                    rotateRight(parentOf(parentOf(x)));
                }
            } else {
                //è¿™é‡Œçš„å¤„ç†è·Ÿä¸Šé¢çš„ç›¸åè¿‡æ¥äº†ã€‚è€Œä¸”å‡ºç°äº†ä¸€ç§æ–°çš„ä¸œè¥¿ï¼Œ
                //ä¸€ç›´ä¸Šé¢æˆ‘ä»¬è¯´çš„3èŠ‚ç‚¹éƒ½åœ¨å·¦å­æ ‘ä¸Šçš„ï¼Œç°åœ¨ç”±äºæ²¡æœ‰2èŠ‚ç‚¹çš„å¤„ç†ï¼Œ
                //æ‰€ä»¥ï¼Œ3èŠ‚ç‚¹å‡ºç°åœ¨å³å­æ ‘ä¸Šã€‚
                Entry<K,V> y = leftOf(parentOf(parentOf(x)));
                //è¿™é‡Œçš„yæ˜¯çº¢è‰²ï¼Œå°±æ„å‘³ç€äº§ç”Ÿäº†ä¸€ä¸ª4èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¦è¿›è¡Œflip colorï¼ŒæŠŠçº¢è‰²å¾€ä¸Šé¢æå‡ã€‚
                if (colorOf(y) == RED) {
                    setColor(parentOf(x), BLACK);
                    setColor(y, BLACK);
                    setColor(parentOf(parentOf(x)), RED);
                    x = parentOf(parentOf(x));
                } else {
                    //è¿™é‡Œä»£è¡¨äº†åœ¨å³å­æ ‘çš„3èŠ‚ç‚¹ä¸­é—´æ’å…¥çš„æƒ…å†µï¼Œè¦è¿›è¡Œå³æ—‹ï¼ˆè·Ÿå·¦å­æ ‘çš„3èŠ‚ç‚¹ç›¸åçš„æ“ä½œï¼‰ã€‚
                    if (x == leftOf(parentOf(x))) {
                        x = parentOf(x);
                        rotateRight(x);
                    }
                    //è¿™é‡Œä»£è¡¨äº†åœ¨å³å­æ ‘3èŠ‚ç‚¹å·¦è¾¹æ’å…¥çš„æƒ…å†µï¼Œè¦è¿›è¡Œå·¦æ—‹ï¼ˆè·Ÿå·¦å­æ ‘çš„3èŠ‚ç‚¹ç›¸åçš„æ“ä½œï¼‰ã€‚
                    setColor(parentOf(x), BLACK);
                    setColor(parentOf(parentOf(x)), RED);
                    rotateLeft(parentOf(parentOf(x)));
                }
            }
        }
        //æ ¹èŠ‚ç‚¹å˜æˆé»‘è‰²
        root.color = BLACK;
    }
````
ä»æ³¨é‡Šä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œå¾ªç¯åªå¤„ç†3èŠ‚ç‚¹çš„æ’å…¥æ“ä½œï¼Œè€Œå¯¹äº2èŠ‚ç‚¹æ“ä½œå´äº§ç”Ÿäº†ä¸€ç§å³å­æ ‘çš„3èŠ‚ç‚¹çš„æ“ä½œï¼Œè¿™ç§æ“ä½œè·Ÿå‰é¢æåˆ°çš„3èŠ‚ç‚¹è¿›è¡Œäº†ç›¸åçš„å¤„ç†ï¼Œå·¦æ—‹æ—¶å€™å˜å³æ—‹ï¼Œå³æ—‹æ—¶å€™å·¦æ—‹ã€‚

å¥½äº†ï¼Œç°åœ¨ç”¨javaçš„å®ç°æ¥å†é‡æ–°çœ‹
`````java
private void fixAfterInsertion(Entry<K,V> x) {
        x.color = RED;  //æ–°æ’å…¥çš„èŠ‚ç‚¹éƒ½æ˜¯çº¢è‰²çš„

        while (x != null && x != root && x.parent.color == RED) {   //å¦‚æœçˆ¶èŠ‚ç‚¹ä¹Ÿæ˜¯çº¢è‰²ï¼Œè¿åäº†è§„åˆ™4ï¼Œå°±éœ€è¦è°ƒæ•´ã€‚
            if (parentOf(x) == leftOf(parentOf(parentOf(x)))) { //å¦‚æœxçš„çˆ¶èŠ‚ç‚¹æ˜¯xçš„ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­ï¼Œ
                Entry<K,V> y = rightOf(parentOf(parentOf(x)));  //yè¡¨ç¤ºxçš„å”çˆ¶èŠ‚ç‚¹ï¼ˆxçš„çˆ¶èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ï¼‰
                /**
                * æƒ…å†µ1ï¼šå¦‚æœxçš„çˆ¶èŠ‚ç‚¹å’Œå”çˆ¶èŠ‚ç‚¹éƒ½æ˜¯çº¢è‰²çš„
                * åˆ™ç¥–çˆ¶èŠ‚ç‚¹è‚¯å®šæ˜¯é»‘è‰²çš„
                * æŠŠç¥–çˆ¶èŠ‚ç‚¹å˜æˆçº¢è‰²çš„ï¼Œçˆ¶äº²èŠ‚ç‚¹å’Œå”çˆ¶èŠ‚ç‚¹å˜æˆé»‘è‰²çš„
                * ï¼ˆä¿è¯ä»ç¥–çˆ¶èŠ‚ç‚¹åˆ°å…¶æ‰€æœ‰å¶å­èŠ‚ç‚¹çš„é»‘è‰²èŠ‚ç‚¹æ•°é‡ä¿æŒä¸å˜ï¼‰
                * æ­¤æ—¶ç¥–çˆ¶èŠ‚ç‚¹ä»é»‘è‰²å˜æˆçº¢è‰²ï¼Œå¯èƒ½è¿åäº†è§„åˆ™4ï¼Œwhileå¾ªç¯ç»§ç»­å¯¹ç¥–çˆ¶èŠ‚ç‚¹è¿›è¡Œè°ƒæ•´
                */
                if (colorOf(y) == RED) {
                    setColor(parentOf(x), BLACK);   //çˆ¶äº²èŠ‚ç‚¹çº¢å˜é»‘
                    setColor(y, BLACK);             //å”çˆ¶èŠ‚ç‚¹çº¢å˜é»‘
                    setColor(parentOf(parentOf(x)), RED);   //ç¥–çˆ¶èŠ‚ç‚¹é»‘å˜çº¢
                    x = parentOf(parentOf(x));  //whileå¾ªç¯ç»§ç»­å¯¹ç¥–çˆ¶è¿›è¡Œè°ƒæ•´
                } else {
                    /**
                    * æƒ…å†µ2ï¼šxçš„å”çˆ¶èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼ˆæˆ‘ä»¬ç”¨pä»£è¡¨xçš„çˆ¶èŠ‚ç‚¹ï¼Œppä»£è¡¨xçš„ç¥–çˆ¶èŠ‚ç‚¹ï¼Œprä»£è¡¨xçš„å”çˆ¶èŠ‚ç‚¹ï¼‰
                    * xå’Œpæ˜¯çº¢è‰²ï¼Œprå’Œppæ˜¯é»‘è‰²ï¼Œä¸èƒ½ç›´æ¥å˜è‰²ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æŠŠpå˜é»‘ï¼Œppå˜çº¢ï¼Œ
                    * ç„¶åå¯¹ppå³æ—‹è½¬ï¼Œå·¦å³åˆ†æ”¯çš„é»‘è‰²èŠ‚ç‚¹æ•°é‡ä¸å˜
                    * ä½†æ˜¯å³æ—‹è½¬ä¼šä½¿pçš„å³å­©å­å˜æˆppçš„å·¦å­©å­ï¼Œppç°åœ¨æ˜¯çº¢è‰²ï¼Œå¦‚æœxæ˜¯pçš„å³å­©å­ï¼ˆçº¢è‰²ï¼‰ï¼Œæ—‹è½¬è¿‡å»å°±ä¼šå†²çªã€‚
                    
                    * æ‰€ä»¥éœ€è¦æå‰åˆ¤æ–­xå¦‚æœæ˜¯pçš„å³å­©å­ï¼Œå¯¹xçš„çˆ¶èŠ‚ç‚¹è¿›è¡Œå·¦æ—‹è½¬ï¼ˆå‚ç…§ä¸Šé¢çš„å·¦æ—‹è½¬ï¼‰
                    * xå˜æˆçˆ¶èŠ‚ç‚¹ï¼Œpå˜æˆå·¦å­©å­ï¼ŒæŠŠçº¢è‰²èŠ‚ç‚¹ç§»åˆ°å·¦åˆ†æ”¯ï¼Œxçš„å³å­©å­æ˜¯é»‘è‰²ï¼Œä¿è¯ä¸‹é¢çš„ç¥–çˆ¶èŠ‚ç‚¹å³æ—‹è½¬ä¸ä¼šå‘ç”Ÿå†²çª
                    * å³æ—‹è½¬ä¹‹åæ–°ç¥–çˆ¶èŠ‚ç‚¹åˆ°å„ä¸ªå­å­™èŠ‚ç‚¹çš„é»‘è‰²èŠ‚ç‚¹æ•°é‡ä»ç„¶ä¿æŒä¸å˜ï¼Œå¹¶ä¸”æ˜¯é»‘è‰²çš„ï¼Œä¸ä¼šå†å’Œå®ƒçš„çˆ¶èŠ‚ç‚¹å†²çªï¼Œè°ƒæ•´åˆ°æ­¤ç»“æŸã€‚
                    * å³æ’å…¥æ“ä½œæœ€å¤šæ—‹è½¬æ“ä½œä¸¤æ¬¡å°±å¯ä»¥è§£å†³å†²çª
                    */
                    if (x == rightOf(parentOf(x))) {
                        x = parentOf(x);    //xæŒ‡å‘çˆ¶äº²èŠ‚ç‚¹
                        rotateLeft(x);      //å¯¹xè¿›è¡Œå·¦æ—‹è½¬ï¼ŒæŠŠçº¢è‰²èŠ‚ç‚¹ç§»åˆ°å·¦è¾¹
                    }
                    setColor(parentOf(x), BLACK);   //çˆ¶èŠ‚ç‚¹å˜è‰²
                    setColor(parentOf(parentOf(x)), RED);   //ç¥–çˆ¶èŠ‚ç‚¹å˜è‰²
                    rotateRight(parentOf(parentOf(x)));     //ç¥–çˆ¶èŠ‚ç‚¹å³æ—‹è½¬
                }
            } else {    //ä¸‹é¢è¿™ç§æƒ…å†µå¯¹ä¸Šé¢çš„å·¦å³å¯¹ç§°ï¼Œæ“ä½œåŸç†ä¸€æ ·
                Entry<K,V> y = leftOf(parentOf(parentOf(x)));
                if (colorOf(y) == RED) {
                    setColor(parentOf(x), BLACK);
                    setColor(y, BLACK);
                    setColor(parentOf(parentOf(x)), RED);
                    x = parentOf(parentOf(x));
                } else {
                    if (x == leftOf(parentOf(x))) {
                        x = parentOf(x);
                        rotateRight(x);
                    }
                    setColor(parentOf(x), BLACK);
                    setColor(parentOf(parentOf(x)), RED);
                    rotateLeft(parentOf(parentOf(x)));
                }
            }
        }
        /**
        * ä¿è¯æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²
        * å‡è®¾xçš„çˆ¶èŠ‚ç‚¹å’Œå”çˆ¶èŠ‚ç‚¹éƒ½æ˜¯çº¢è‰²ï¼Œç¥–çˆ¶èŠ‚ç‚¹æ˜¯é»‘è‰²å¹¶ä¸”æ˜¯æ ¹èŠ‚ç‚¹
        * ç¬¦åˆæƒ…å†µ1ï¼Œé‚£ä¹ˆæŠŠçˆ¶èŠ‚ç‚¹å”çˆ¶èŠ‚ç‚¹å˜é»‘ï¼Œç¥–çˆ¶èŠ‚ç‚¹å˜çº¢ï¼Œå†²çªè§£å†³
        * x = parentOf(parentOf(x));æ­¤æ—¶xæ˜¯æ ¹èŠ‚ç‚¹ä¸ä¼šå†è°ƒæ•´ï¼Œä½†æ˜¯æ­¤æ—¶xæ˜¯çº¢è‰²çš„ï¼Œä¸æ»¡è¶³è§„åˆ™2ï¼Œæ‰€ä»¥æŠŠæ ¹èŠ‚ç‚¹ç½®é»‘ã€‚
        */
        root.color = BLACK;
    }
`````

### ç¤ºä¾‹

å†æ¥ä¸ªå®ä¾‹çœ‹çœ‹ï¼Œå¥½ç†è§£

ä»¥ä¸‹å›¾çº¢é»‘æ ‘ä¸ºä¾‹
[![](http://idiotsky.me/images2/java-treemap-46.png)](http://idiotsky.me/images2/java-treemap-46.png)

ç°åœ¨æˆ‘ä»¬è¦å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹50ï¼Œæ”¾åœ¨èŠ‚ç‚¹47çš„å³å­æ ‘ä¸Šã€‚

[![](http://idiotsky.me/images2/java-treemap-47.png)](http://idiotsky.me/images2/java-treemap-47.png)

æ–°å¢èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹å†²çªï¼Œå”çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œè¿›è¡Œå˜è‰²æ“ä½œï¼ŒæŠŠçˆ¶äº²èŠ‚ç‚¹å’Œå”çˆ¶èŠ‚ç‚¹éƒ½å˜æˆé»‘è‰²ï¼Œç¥–çˆ¶èŠ‚ç‚¹å˜æˆçº¢è‰²ï¼Œç„¶åå†å¯¹ç¥–çˆ¶èŠ‚ç‚¹è¿›è¡Œè°ƒæ•´ã€‚

````java
if (colorOf(y) == RED) {
                    setColor(parentOf(x), BLACK);
                    setColor(y, BLACK);
                    setColor(parentOf(parentOf(x)), RED);
                    x = parentOf(parentOf(x));
                }
````

[![](http://idiotsky.me/images2/java-treemap-48.png)](http://idiotsky.me/images2/java-treemap-48.png)

å”çˆ¶èŠ‚ç‚¹yæ˜¯é»‘è‰²çš„ï¼Œå¹¶ä¸”xæ˜¯å³å­©å­ï¼Œå…ˆè¿›è¡Œå·¦æ—‹è½¬ï¼ŒæŠŠçº¢è‰²èŠ‚ç‚¹è½¬ç§»åˆ°å·¦åˆ†æ”¯ã€‚

````java
if (x == rightOf(parentOf(x))) {
                        x = parentOf(x);
                        rotateLeft(x);
                    }

````

[![](http://idiotsky.me/images2/java-treemap-49.png)](http://idiotsky.me/images2/java-treemap-49.png)

å†æŠŠxçš„çˆ¶èŠ‚ç‚¹å˜é»‘ï¼Œç¥–çˆ¶èŠ‚ç‚¹å˜çº¢ï¼Œç„¶åæŠŠç¥–çˆ¶èŠ‚ç‚¹å³æ—‹è½¬ã€‚

````java
setColor(parentOf(x), BLACK);
setColor(parentOf(parentOf(x)), RED);
rotateRight(parentOf(parentOf(x)));
````

[![](http://idiotsky.me/images2/java-treemap-50.png)](http://idiotsky.me/images2/java-treemap-50.png)

å°±è¿™æ ·ï¼Œåˆç¬¦åˆä¸Šé¢çš„è§„åˆ™äº†ã€‚å…¶å®ç”¨2-3æ ‘çš„æ€ç»´çœ‹ä¸Šé¢çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸æ˜¯è·Ÿå‰ä¸€ç« åŸºäº2-3æ ‘çš„çº¢é»‘æ ‘çš„å¹³è¡¡è¿‡ç¨‹ç±»ä¼¼å‘¢ã€‚


## åˆ é™¤
å‰é¢çš„ç« èŠ‚æ²¡å…³äºçº¢é»‘æ ‘çš„åˆ é™¤ï¼Œå› ä¸ºæœ¬èº«å°±æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤æ“ä½œï¼Œæ‰€ä»¥çº¢é»‘æ ‘åªæ˜¯æ¯”äºŒå‰æŸ¥æ‰¾æ ‘å¤šäº†ä¸€ä¸ªè‡ªå¹³è¡¡çš„æ“ä½œã€‚

````java
private void deleteEntry(Entry<K,V> p) {
        modCount++;
        size--;

        //æœ‰ä¸¤ä¸ªå­©å­çš„è¯ï¼Œæ‰¾åˆ°å®ƒçš„åç»§ï¼Œç„¶åç”¨åç»§çš„å€¼æ›´æ–°äº†è¦åˆ é™¤çš„èŠ‚ç‚¹
        //è¿™æ ·åŸºæœ¬ç­‰äºè¦åˆ é™¤çš„èŠ‚ç‚¹è¢«åç»§çš„å€¼è¦†ç›–äº†
        if (p.left != null && p.right != null) {
            Entry<K,V> s = successor(p);
            p.key = s.key;
            p.value = s.value;
            //è®©pæŒ‡å‘åç»§ï¼Œå°±æ˜¯æ–¹ä¾¿åé¢æŠŠåç»§å½“æˆè¦åˆ é™¤çš„èŠ‚ç‚¹æ¥åˆ æ‰ã€‚
            p = s;
        } 

        //æ‰¾åˆ°æ›¿æ¢èŠ‚ç‚¹
        Entry<K,V> replacement = (p.left != null ? p.left : p.right);

        //æ›¿æ¢èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œä»£è¡¨è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰å­©å­
        if (replacement != null) {
            // æ›¿æ¢èŠ‚ç‚¹çš„çˆ¶äº²å’Œè¦åˆ é™¤çš„èŠ‚ç‚¹è¦ä¸€è‡´
            replacement.parent = p.parent;
            //å¦‚æœè¦åˆ é™¤å°±æ˜¯æ ¹èŠ‚ç‚¹
            if (p.parent == null)
                //ç›´æ¥æ ¹ç»“ç‚¹æŒ‡å‘æ›¿æ¢èŠ‚ç‚¹ã€‚
                root = replacement;
            //pçš„çˆ¶äº²æŒ‡å‘æ›¿æ¢èŠ‚ç‚¹ã€‚
            else if (p == p.parent.left)
                p.parent.left  = replacement;
            else
                p.parent.right = replacement;

            //åˆ é™¤(unlink)pï¼Œæ–¹ä¾¿gc
            p.left = p.right = p.parent = null;

            if (p.color == BLACK)
                //ä¸Šé¢å¼•ç”³è§„åˆ™è¯´è¿‡ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªå­©å­ï¼Œé‚£ä¹ˆè¿™ä¸ªå­©å­å°±ä¸€å®šæ˜¯çº¢è‰²çš„
                //æ‰€ä»¥replacementä¸€å®šæ˜¯çº¢è‰²çš„ã€‚
                //æ‰€ä»¥æ›¿æ¢èŠ‚ç‚¹ç”¨çº¢è‰²æ›¿æ¢è¦åˆ é™¤çš„é»‘è‰²èŠ‚ç‚¹çš„è¯ï¼Œé‚£æ ·ä¼šè¿æ³•è§„åˆ™5ï¼Œä½¿å¾—
                //é»‘è‰²æ•°é‡å‡å°‘ï¼Œæ‰€ä»¥ä¸‹é¢çš„å‡½æ•°ï¼Œå…¶å®åšçš„äº‹æƒ…ç›¸å½“äºsetColor(replacement, BLACK);
                //æŠŠreplacementå˜æˆé»‘è‰²ï¼Œæ²¡æœ‰ä»»ä½•é»‘è‰²æ•°é‡å‡å°‘äº†ã€‚
                //å¾ˆæ˜æ˜¾ï¼Œä¸‹é¢å‡½æ•°ä¸€å¼€å§‹çš„åˆ¤æ–­æ¡ä»¶å°±ä¸æ»¡è¶³äº†ï¼Œç›´æ¥åˆ°æŠŠreplacementå˜æˆé»‘è‰²
                fixAfterDeletion(replacement);
        } else if (p.parent == null) { // å¦‚æœæ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„è¯ï¼Œç›´æ¥rootèµ‹å€¼ä¸ºnull
            root = null;
        } else { // æ›¿æ¢èŠ‚ç‚¹ä¸ºnullï¼Œä»£è¡¨è¦åˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å­©å­
            if (p.color == BLACK)
                //è¦åˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å­©å­ï¼Œè€Œä¸”æ˜¯é»‘è‰²çš„è¯ï¼Œä¼šè¿åè§„åˆ™5çš„ï¼Œ
                //æ‰€ä»¥è¿™é‡Œè¦è¿›è¡Œè°ƒæ•´è¿™ä¸ªèŠ‚ç‚¹ï¼Œä½¿ä»–åœ¨åˆ é™¤ä¹‹åä¸ä¼šå½±å“é»‘è‰²çš„æ•°é‡ã€‚
                fixAfterDeletion(p);
            //å°†pçš„çˆ¶äº²æ‰€æœ‰æŒ‡å‘pçš„é“¾æ¥æŒ‡å‘null
            if (p.parent != null) {
                if (p == p.parent.left)
                    p.parent.left = null;
                else if (p == p.parent.right)
                    p.parent.right = null;
                //åˆ é™¤(unlink)pï¼Œæ–¹ä¾¿gc
                p.parent = null;
            }
        }
    }
````
ä»ä¸Šé¢äºŒå‰æ ‘æŸ¥æ‰¾æ ‘åˆ é™¤çš„ç« èŠ‚çŸ¥é“ï¼Œ1.å¦‚æœè¦åˆ é™¤èŠ‚ç‚¹æ²¡å­©å­ï¼Œç›´æ¥åˆ æ‰å³å¯ï¼Œ2.å¦‚æœä¸€ä¸ªå­©å­çš„ï¼Œå°±ç›´æ¥ç”¨å­©å­æ›¿æ¢å³å¯ï¼Œ3.å¯¹äºä¸¤ä¸ªå­©å­çš„èŠ‚ç‚¹ï¼Œä¸Šé¢ä»£ç æœ‰ä¸ªå·§å¦™çš„åœ°æ–¹ï¼Œå°±æ˜¯æ‰¾åˆ°åç»§ä¹‹åï¼Œç›´æ¥ç”¨åç»§çš„å€¼è¦†ç›–åˆ é™¤èŠ‚ç‚¹çš„å€¼ï¼Œä¹‹åæŠŠè¦åˆ é™¤çš„èŠ‚ç‚¹æŒ‡å‘æˆåç»§èŠ‚ç‚¹ï¼Œè€Œåç»§èŠ‚ç‚¹æ˜¯åªæœ‰ä¸€ä¸ªå­©å­æˆ–æ²¡æœ‰å­©å­ï¼Œè¿™æ ·çš„åç»§èŠ‚ç‚¹åˆšå¥½å¯ä»¥å¤ç”¨å‰é¢è¯´çš„ä¸¤ç§æƒ…å†µçš„ä»£ç äº†ã€‚

å‡½æ•°`fixAfterDeletion`ä¸»è¦ç”¨æ¥è§£å†³è¿åè§„åˆ™5çš„æƒ…å†µï¼Œå³åˆ é™¤äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œå¦‚æœå®ƒæ²¡æœ‰å­©å­ï¼Œæƒ…å†µæ›´å¤æ‚ï¼Œè°ƒæ•´æœ‰3ç§æƒ…æ™¯ï¼š
1. å¦‚æœå…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œç»è¿‡å˜è‰²æ—‹è½¬ï¼Œåœ¨xèŠ‚ç‚¹ä¸Šé¢å¢åŠ ä¸€ä¸ªçº¢è‰²çš„çˆ¶äº²èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸ç ´åå…¶ä»–åˆ†æ”¯çš„é»‘è‰²èŠ‚ç‚¹æ•°é‡ã€‚
2. å…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼Œå¦‚æœå…„å¼ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼Œç›´æ¥æŠŠé»‘è‰²èŠ‚ç‚¹å˜çº¢ï¼Œå³å‡å°‘å…„å¼Ÿåˆ†æ”¯çš„é»‘è‰²èŠ‚ç‚¹æ•°é‡ï¼Œç„¶åå¯¹å…¶çˆ¶èŠ‚ç‚¹è¿›è¡Œè°ƒæ•´ï¼›
3. å…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼Œä½†å…¶æœ‰çº¢è‰²çš„å­©å­èŠ‚ç‚¹ï¼Œä¸èƒ½ç›´æ¥å˜çº¢ã€‚å¦‚æœå·¦å­©å­æ˜¯çº¢è‰²èŠ‚ç‚¹ï¼Œç»è¿‡å˜è‰²å’Œå³æ—‹è½¬æŠŠçº¢è‰²èŠ‚ç‚¹ç§»åˆ°å³è¾¹ã€‚æ­¤æ—¶å†ç»è¿‡å˜è‰²ï¼Œå¹¶å¯¹xçš„çˆ¶èŠ‚ç‚¹è¿›è¡Œå·¦æ—‹è½¬ï¼Œåœ¨xèŠ‚ç‚¹çš„ä¸Šé¢å¢åŠ ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸ç ´åå…¶ä»–åˆ†æ”¯çš„é»‘è‰²èŠ‚ç‚¹æ•°é‡ï¼Œè°ƒæ•´ç»“æŸã€‚

````java
private void fixAfterDeletion(Entry<K,V> x) {
        while (x != root && colorOf(x) == BLACK) {  //èŠ‚ç‚¹xä¸æ˜¯æ ¹èŠ‚ç‚¹å¹¶ä¸”æ˜¯é»‘è‰²æ‰è¿›è¡Œå¤„ç†
            if (x == leftOf(parentOf(x))) { //xæ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­
                Entry<K,V> sib = rightOf(parentOf(x));  //sibè¡¨ç¤ºxçš„å…„å¼ŸèŠ‚ç‚¹
                
                /**
                * å¦‚æœå…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œé‚£ä¹ˆçˆ¶èŠ‚ç‚¹è‚¯å®šæ˜¯é»‘è‰²çš„
                * æŠŠå…„å¼ŸèŠ‚ç‚¹å˜é»‘ï¼Œçˆ¶èŠ‚ç‚¹å˜çº¢ï¼Œç„¶åå¯¹çˆ¶èŠ‚ç‚¹å·¦æ—‹è½¬
                * å…„å¼ŸèŠ‚ç‚¹å˜æˆçˆ¶èŠ‚ç‚¹ï¼Œå¹¶ä¸”åˆ°å³å­æ ‘çš„é»‘è‰²èŠ‚ç‚¹æ•°é‡ä¸å˜ï¼ˆç”±1é»‘1çº¢å˜æˆ1é»‘ï¼‰
                * 
                * å³æƒ…æ™¯1ï¼Œåœ¨xèŠ‚ç‚¹ä¸Šå¢åŠ ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼ˆçº¢è‰²ï¼‰ã€‚
                */
                
                if (colorOf(sib) == RED) {
                    setColor(sib, BLACK);
                    setColor(parentOf(x), RED);
                    rotateLeft(parentOf(x));
                    sib = rightOf(parentOf(x)); //æ—‹è½¬ä¹‹åé‡æ–°èµ‹å€¼å…„å¼ŸèŠ‚ç‚¹sibï¼ŒåŸsibå˜æˆxçš„ç¥–çˆ¶èŠ‚ç‚¹ï¼ˆè§å·¦æ—‹è½¬åŠ¨å›¾ï¼‰
                }
                
                /**
                * è¿›è¡Œä¸Šä¸€æ­¥çš„åˆ¤æ–­å¤„ç†åï¼Œæ­¤æ—¶å…„å¼ŸèŠ‚ç‚¹è‚¯å®šæ˜¯é»‘è‰²çš„ã€‚
                * å¦‚æœå…„å¼ŸèŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå…„å¼ŸèŠ‚ç‚¹å˜çº¢ã€‚
                * ç„¶åwhileå¾ªç¯ç»§ç»­è°ƒæ•´å…¶çˆ¶èŠ‚ç‚¹ï¼Œå³æƒ…æ™¯2ã€‚
                */

                if (colorOf(leftOf(sib))  == BLACK &&
                    colorOf(rightOf(sib)) == BLACK) {
                    setColor(sib, RED);
                    x = parentOf(x);
                } else {    //å…„å¼ŸèŠ‚ç‚¹ä¸èƒ½ç›´æ¥å˜çº¢çš„æƒ…å†µä¸‹ï¼Œå³æƒ…æ™¯3
                    /**
                    * å¦‚æœå…„å¼ŸèŠ‚ç‚¹çš„å·¦å­©å­æ˜¯çº¢è‰²ï¼Œå³å­©å­æ˜¯é»‘è‰²
                    * å…„å¼ŸèŠ‚ç‚¹çš„å·¦å­©å­å˜é»‘ï¼Œå…„å¼ŸèŠ‚ç‚¹å˜çº¢ï¼Œå¯¹å…„å¼ŸèŠ‚ç‚¹å³æ—‹è½¬ï¼ŒæŠŠçº¢è‰²èŠ‚ç‚¹è½¬ç§»åˆ°å³åˆ†æ”¯
                    */
                    if (colorOf(rightOf(sib)) == BLACK) {
                        setColor(leftOf(sib), BLACK);
                        setColor(sib, RED);
                        rotateRight(sib);
                        sib = rightOf(parentOf(x)); //é‡æ–°èµ‹å€¼å…„å¼ŸèŠ‚ç‚¹
                    }
                    /**
                    * ç»è¿‡ä¸Šä¸€æ­¥åˆ¤æ–­å¤„ç†ï¼Œå…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œå…„å¼ŸèŠ‚ç‚¹çš„å·¦å­©å­æ˜¯é»‘è‰²ï¼Œå…„å¼ŸèŠ‚ç‚¹çš„å³å­©å­æ˜¯çº¢è‰²ï¼Œ
                    * æŠŠå…„å¼ŸèŠ‚ç‚¹å˜æˆçˆ¶èŠ‚ç‚¹çš„é¢œè‰²ï¼Œå…„å¼ŸèŠ‚ç‚¹çš„å³å­©å­å˜æˆé»‘è‰²ï¼ˆä¸ç ´åå³åˆ†æ”¯çš„è§„åˆ™ï¼‰ï¼Œçˆ¶èŠ‚ç‚¹å˜æˆé»‘è‰²ï¼Œå¯¹çˆ¶äº²èŠ‚ç‚¹å·¦æ—‹è½¬ï¼Œ
                    * ä¸»è¦å°±åœ¨xèŠ‚ç‚¹çš„ä¸Šé¢å¢åŠ äº†ä¸€ä¸ªé»‘è‰²çš„çˆ¶èŠ‚ç‚¹ï¼Œå³æƒ…æ™¯3ï¼Œè°ƒæ•´ç»“æŸã€‚
                    */
                    setColor(sib, colorOf(parentOf(x)));
                    setColor(parentOf(x), BLACK);
                    setColor(rightOf(sib), BLACK);
                    rotateLeft(parentOf(x));
                    x = root;
                }
            } else { // xèŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å³å­©å­ï¼Œè°ƒæ•´æ–¹æ³•å’Œä¸Šé¢çš„å¯¹ç§°ã€‚
                Entry<K,V> sib = leftOf(parentOf(x));

                if (colorOf(sib) == RED) {
                    setColor(sib, BLACK);
                    setColor(parentOf(x), RED);
                    rotateRight(parentOf(x));
                    sib = leftOf(parentOf(x));
                }

                if (colorOf(rightOf(sib)) == BLACK &&
                    colorOf(leftOf(sib)) == BLACK) {
                    setColor(sib, RED);
                    x = parentOf(x);
                } else {
                    if (colorOf(leftOf(sib)) == BLACK) {
                        setColor(rightOf(sib), BLACK);
                        setColor(sib, RED);
                        rotateLeft(sib);
                        sib = leftOf(parentOf(x));
                    }
                    setColor(sib, colorOf(parentOf(x)));
                    setColor(parentOf(x), BLACK);
                    setColor(leftOf(sib), BLACK);
                    rotateRight(parentOf(x));
                    x = root;
                }
            }
        }

        setColor(x, BLACK);
    }
````
### ç¤ºä¾‹
#### åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆåˆ é™¤390ï¼‰
æ ¹æ®ä¸Šé¢çš„å¼•ç”³è§„åˆ™ï¼Œè¿™ä¸ªèŠ‚ç‚¹è‚¯å®šæ˜¯é»‘è‰²ï¼Œå­èŠ‚ç‚¹æ˜¯çº¢è‰²
[![](http://idiotsky.me/images2/java-treemap-51.png)](http://idiotsky.me/images2/java-treemap-51.png)

#### åˆ é™¤çº¢è‰²çš„èŠ‚ç‚¹å¹¶ä¸”æ²¡æœ‰å­èŠ‚ç‚¹ï¼ˆåˆ é™¤833ï¼‰
[![](http://idiotsky.me/images2/java-treemap-52.png)](http://idiotsky.me/images2/java-treemap-52.png)

#### åˆ é™¤é»‘è‰²çš„èŠ‚ç‚¹å¹¶ä¸”æ²¡æœ‰å­èŠ‚ç‚¹ï¼ˆåˆ é™¤22ï¼‰
##### å…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²çš„æƒ…å†µ
[![](http://idiotsky.me/images2/java-treemap-53.png)](http://idiotsky.me/images2/java-treemap-53.png)

å˜è‰²+æ—‹è½¬ï¼Œç»™xèŠ‚ç‚¹å¢åŠ ä¸€ä¸ªçº¢è‰²çš„çˆ¶äº²èŠ‚ç‚¹
````java
if (colorOf(sib) == RED) {
                    setColor(sib, BLACK);
                    setColor(parentOf(x), RED);
                    rotateLeft(parentOf(x));
                    sib = rightOf(parentOf(x));
}
````
[![](http://idiotsky.me/images2/java-treemap-54.png)](http://idiotsky.me/images2/java-treemap-54.png)

æ­¤æ—¶xçš„æ–°å…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œå¹¶ä¸”å­©å­èŠ‚ç‚¹å…¨æ˜¯é»‘è‰²ï¼ˆå¶å­èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼‰ï¼ŒæŠŠå…„å¼ŸèŠ‚ç‚¹å˜è‰²ï¼Œç„¶åxæŒ‡å‘çˆ¶èŠ‚ç‚¹ï¼Œwhileå¾ªç¯ç»§ç»­è°ƒæ•´ã€‚
````java
if (colorOf(leftOf(sib))  == BLACK &&
                    colorOf(rightOf(sib)) == BLACK) {
                    setColor(sib, RED);
                    x = parentOf(x);
````
[![](http://idiotsky.me/images2/java-treemap-55.png)](http://idiotsky.me/images2/java-treemap-55.png)

èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œè·³å‡ºå¾ªç¯ã€‚å¾ªç¯å¤–æŠŠè¯¥èŠ‚ç‚¹å˜é»‘ã€‚
````java
while (x != root && colorOf(x) == BLACK) {}
setColor(x, BLACK);
````

[![](http://idiotsky.me/images2/java-treemap-56.png)](http://idiotsky.me/images2/java-treemap-56.png)

æ–¹æ³•è¿”å›åï¼ŒdeleteEntryæ–¹æ³•æŠŠ22èŠ‚ç‚¹åˆ é™¤ï¼Œæ•´ä¸ªè¿‡ç¨‹ç»“æŸã€‚

````java
if (p.parent != null) {
                if (p == p.parent.left)
                    p.parent.left = null;
                else if (p == p.parent.right)
                    p.parent.right = null;
                p.parent = null;
            }

````
[![](http://idiotsky.me/images2/java-treemap-57.png)](http://idiotsky.me/images2/java-treemap-57.png)

##### å…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²çš„æƒ…å†µ
ä¸Šé¢æ˜¯æ—‹è½¬å˜åŒ–è¿‡ç¨‹ä¸­å…¶å®å·²ç»é‡è§äº†è¿™ç§æƒ…å†µï¼Œå¹¶ä¸”å…„å¼ŸèŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹å…¨æ˜¯é»‘è‰²ï¼Œå¯ä»¥ç›´æ¥å˜è‰²å¤„ç†ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹ï¼Œå…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œå¹¶ä¸”æœ‰å­©å­èŠ‚ç‚¹æ˜¯çº¢è‰²çš„æƒ…å†µ

ç»§ç»­ä¸Šé¢çš„çº¢é»‘æ ‘ï¼Œä¸‹é¢åˆ é™¤65èŠ‚ç‚¹

[![](http://idiotsky.me/images2/java-treemap-58.png)](http://idiotsky.me/images2/java-treemap-58.png)

å…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œå¹¶ä¸”æœ‰çº¢è‰²çš„å­©å­èŠ‚ç‚¹ï¼Œé’ˆå¯¹xæ˜¯å·¦å­©å­çš„æƒ…å†µä¸‹ï¼Œå¦‚æœçº¢è‰²èŠ‚ç‚¹æ˜¯å·¦å­©å­ï¼Œéœ€è¦é€šè¿‡æ—‹è½¬æ“ä½œç§»åˆ°å³è¾¹

````java
if (colorOf(rightOf(sib)) == BLACK) {
                        setColor(leftOf(sib), BLACK);
                        setColor(sib, RED);
                        rotateRight(sib);
                        sib = rightOf(parentOf(x));
                    }
````

[![](http://idiotsky.me/images2/java-treemap-59.png)](http://idiotsky.me/images2/java-treemap-59.png)

ç„¶åå†è¿›è¡Œå˜è‰²æ—‹è½¬æ“ä½œï¼Œç»™xèŠ‚ç‚¹å¢åŠ ä¸€ä¸ªé»‘è‰²çš„çˆ¶èŠ‚ç‚¹ã€‚x = rootç»“æŸå¾ªç¯ã€‚
````java
setColor(sib, colorOf(parentOf(x)));
setColor(parentOf(x), BLACK);
setColor(rightOf(sib), BLACK);
rotateLeft(parentOf(x));
x = root;
````
[![](http://idiotsky.me/images2/java-treemap-60.png)](http://idiotsky.me/images2/java-treemap-60.png)

æ–¹æ³•è¿”å›ï¼ŒdeleteEntryæ–¹æ³•æŠŠ65èŠ‚ç‚¹åˆ é™¤ï¼Œæ•´ä¸ªè¿‡ç¨‹ç»“æŸã€‚

#### åˆ é™¤èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹çš„æƒ…å†µ
[![](http://idiotsky.me/images2/java-treemap-61.png)](http://idiotsky.me/images2/java-treemap-61.png)

åˆ é™¤èŠ‚ç‚¹55ï¼Œè¯¥èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ï¼ŒdeleteEntryæ–¹æ³•ä¸­ä¼šæŸ¥æ‰¾ç»§æ‰¿è€…èŠ‚ç‚¹ï¼Œå³å›¾ä¸­çš„65èŠ‚ç‚¹ï¼ŒæŠŠ65èŠ‚ç‚¹çš„keyå’Œvalueèµ‹å€¼ç»™55èŠ‚ç‚¹ï¼Œç„¶åè½¬åŒ–ä¸ºåˆ é™¤pæŒ‡å‘çš„65èŠ‚ç‚¹ã€‚
````java
if (p.left != null && p.right != null) {
            Entry<K,V> s = successor(p);
            p.key = s.key;
            p.value = s.value;
            p = s;
        }
````
[![](http://idiotsky.me/images2/java-treemap-62.jpg)](http://idiotsky.me/images2/java-treemap-62.jpg)
å› ä¸ºç»§æ‰¿è€…èŠ‚ç‚¹æ²¡æœ‰å·¦å­©å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜åˆå˜æˆäº†åˆ é™¤æœ‰ä¸€ä¸ªå­©å­èŠ‚ç‚¹æˆ–è€…æ— å­©å­èŠ‚ç‚¹çš„é—®é¢˜ã€‚ï¼ˆå‚ç…§ä¸Šé¢ï¼‰

# æ€»ç»“
å¾ˆé•¿ä¸€ç¯‡æ–‡ç« ï¼ŒåŸºæœ¬åŒ…å«äº†è·Ÿæ ‘ç›¸å…³çš„æ•°æ®ç»“æ„äº†ï¼Œmarkä¸‹æ¥ä»¥åå¿˜äº†å›æ¥çœ‹çœ‹ğŸ‘¿

javaé™¤äº†treemapå¤–ï¼Œtreesetä¹Ÿç”¨äº†çº¢é»‘æ ‘ï¼Œè€Œä¸”hashmapå’Œä¸€äº›ä¾èµ–é“¾è¡¨ä½œä¸ºæŸ¥æ‰¾çš„æ•°æ®ç»“æ„éƒ½ä¼šåœ¨æœ€åä»é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘æ¥æé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚

javaåœ¨çº¢é»‘æ ‘çš„å®ç°ä¸Šæœ‰åˆ«äºåŸºäº2-3æ ‘å®ç°çš„çº¢é»‘æ ‘ï¼Œä½†æ˜¯æœ€ç»ˆäº§ç”Ÿçš„çº¢é»‘æ ‘ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚

å‚è€ƒ 
http://www.jianshu.com/p/43b6b90555ca 
http://www.cnblogs.com/yangecnu/p/Introduce-Binary-Search-Tree.html
http://www.cnblogs.com/yangecnu/p/Introduce-2-3-Search-Tree.html
https://algs4.cs.princeton.edu/33balanced/
http://www.cnblogs.com/yangecnu/p/Introduce-Red-Black-Tree.html
https://juejin.im/post/5a6bf78a6fb9a01caf37a4bb